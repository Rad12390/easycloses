{% extends "::base.html.twig" %}

{% block title %}
    {% if listingRepresent is not null and listingRepresent == 'Seller' %}
        Create Buyer
    {% elseif listingRepresent is not null and listingRepresent == 'Landlord' %}
        Create Tenant
    {% else %}
        Create Buyer
    {% endif %}
{% endblock %}

{% block breadcrumbs %}
    <li>
        <i class="fa fa-circle"></i>
        <a href="{{ path('transaction_index') }}">Transactions</a>
    </li>
    {% if closingId is not null %}
        <li>
            <i class="fa fa-circle"></i>
            <a href="{{ path('transaction_view', {'id': transaction.id}) }}">Edit Closing "{{ transaction.fullAddress }}"</a>
        </li>
    {% else %}
        <li>
            <i class="fa fa-circle"></i>
            Create Closing
        </li>
    {% endif %}
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('system/global/plugins/typeahead/typeahead.css') }}"/>
    <link rel="stylesheet" href="{{ asset('system/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.css') }}"/>
    <link rel="stylesheet" href="{{ asset('system/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('system/global/plugins/bootstrap-toastr/toastr.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('system/global/plugins/select2/css/select2.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('system/global/plugins/select2/css/select2-bootstrap.min.css') }}">

    <style type="text/css">
        .tt-hint, .tt-input {
            color: #000000;
        }
        .create_transaction .control-group.error input, .input-group.error input, .control-group.error select, .control-group.error textarea, .control-group.error radio {
            border-color: red;
            background: rgb(250, 255, 189) !important;
        }

        .create_transaction .control-group.success input, .input-group.success input, .control-group.success select, .control-group.success textarea, .control-group.success radio {
            border-color: #468847!important; /*^@ issue2*/
        }
        .control-group.success select{
          background: #fff !important; /* ^@ issue1 */
        }
        .custom_referral_value {
            width: 127px;
        }
        .custom_referral_type {
            width: 70px;
        }
        tr.contact_error .contact_status {
            color: rgb(255, 0, 0);
        }
        tr.contact_success .contact_status {
            color: rgb(0, 128, 0);
        }
        
        {% if loanBoxShow != true %}
        .custom_box {
            display: none;
        }
        {% endif %}
        {% if referralBoxShow != true %}
        .custom_box_referral {
            display: none;
        }
        {% endif %}
        {% if hoaBoxShow != true %}
        .custom_box_hoa {
            display: none;
        }
        {% endif %}
        .radio input[type=radio], .radio-inline input[type=radio], .checkbox input[type=checkbox], .checkbox-inline input[type=checkbox] {
            margin-left: -10px !important;
        }
        input:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 1000px white inset;
        }
        #transactionClosing_closing_agentCommissions_0_value, #transactionClosing_closing_totalCommissions_0_value ,#transactionClosing_closing_buyerAgentCommissions_0_value{
            color:#555 !important;
        }
    </style>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript" src="{{ asset('system/global/plugins/typeahead/handlebars.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/global/plugins/typeahead/typeahead.bundle.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/global/plugins/jquery-validation/js/jquery.validate.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/global/plugins/jquery-inputmask/jquery.inputmask.bundle.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/easycloses-scripts/autofill-mls.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/global/plugins/bootstrap-toastr/toastr.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/pages/scripts/ui-toastr.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('system/global/plugins/select2/js/select2.full.js') }}"></script>


    {# Added for  transactions validation. #}

    <script>
         function errorValidation(selector){
               $('#'+selector).closest(".error").addClass("control-group");
               $('#'+selector).css("border-color","red");
               $("#"+selector).css("background","rgb(250, 255, 189)");
            }
            function successValidation(selector){
               $('#'+selector).closest(".success").addClass("control-group");
               $('#'+selector).css("border-color","green");
               $("#"+selector).css("background","#fff");
            }
            function noValidation(selector){
                $('#'+selector).css('border-color','#ccc');
                $('#'+selector).css('background','#fff');
            }
         function quickFixFields(){
                 if($('#transactionClosing_closing_titleCompanyContact_contactName').val()){
                    $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('error');
                    $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').addClass('success');
                }else{
                    $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('success');
                    $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').addClass('error');

                }

                
                if($('#transactionClosing_closing_moneyBox_paymentType').val()){
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').removeClass('error');
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').addClass('success');

                }else{
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').removeClass('success');
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').addClass('error');

                }
                
                if($("#transactionClosing_closing_sellerContact_email").closest(".control-group").hasClass("error")){
                    $("#transactionClosing_closing_sellerContact_email").css("border-color","red");
                }
                
                if($("#transactionClosing_closing_buyerContact_address_city").closest(".control-group").hasClass("error")){
                    $("#transactionClosing_closing_buyerContact_address_city").css("border-color","red");
                }
                
                if($("#transactionClosing_closing_buyersAgentContact_email").closest(".control-group").hasClass("error")){
                    $("#transactionClosing_closing_buyersAgentContact_email").css("border-color","red");
                }
}        //code ^@
        //code ^%
        function quickfixcolor(id,option){
             {#if(id == 'transactionClosing_closing_buyerContact_phone' || id=='transactionClosing_closing_buyerContact_email'){
                 
                    if(option== 'Seller' || option=='Seller&Buyer'){
                        if( $('#'+id).val()){
                            $('#'+id).closest(".control-group").addClass("success");
                            $('#'+id).closest(".control-group").removeClass("error");
                            $('#'+id).css("border-color","green");
                            $('#'+id).css("background","#fff");
                        }
                        else{
                            $('#'+id).closest(".control-group").removeClass("success");
                            $('#'+id).closest(".control-group").addClass("error");
                            $('#'+id).css("border-color","red");
                            $('#'+id).css("background","rgb(250, 255, 189)"); 
                        }
                       
                    }
                }#}
        }
        $(window).load(function() {
            $('#create_form').find('.control-group').find('.tt-input').addClass('distinct-input');
            $('#create_form').find('.control-group').find('.tt-hint').removeClass('required validate-for-row'); //^@
            $('#create_form').find('.control-group').find('.tt-hint').removeClass('required validate-for-row'); //^@
            $('#create_form').find('.control-group').find('.tt-hint').addClass('donotvalidate'); //^@
            $("#transactionClosing_transactionProperty_property_type").addClass("required");
            $("#transactionClosing_listing_represent").addClass("required");
            $("#transactionClosing_listing_type").addClass("required");
            $("#transactionClosing_transactionProperty_property_address_street").addClass("required");
            $("#transactionClosing_transactionProperty_property_address_city").addClass("required");
            $("#transactionClosing_closing_moneyBox_paymentType").addClass("required");
            //code to add required class if client type is buyer or Tenant
            $("#trans_contacts_wrapper").find('input') .each(function() {
                if($(this).closest('.control-group').hasClass("success") || $(this).closest('.control-group').hasClass("error") || $(this).closest('.lisa').hasClass("error") || $(this).closest('.lisa').hasClass("success")){
                        if($(this).hasClass("tt-hint"))
                            $(this).removeClass("required");
                        else{
                            $(this).addClass("required");
                            $(this).removeClass("donotvalidate");
                        }
                    }
            });
            
            $('#trans_contacts_wrapper').find('input').on('input',function(e){
                if($(this).closest('.control-group').hasClass("success")){
                    $(this).closest(".success").addClass("control-group");
                    $(this).css("border-color","red");
                   // $(this).css("background-color","rgb(250, 255, 189)");
                }
                if($(this).closest('.control-group').hasClass("error")){
                   $(this).closest(".error").addClass("control-group");
                   $(this).css("border-color","green");
                   $(this).css("background-color","#fff");
                }
            });
            
            if($("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("success") || $("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("error")){
                   $("#transactionClosing_closing_buyerAgentCommissions_0_value").addClass("required"); 
            }
            if($("#transactionClosing_closing_agentCommissions_0_value").closest('.control-group').hasClass("success") || $("#transactionClosing_closing_agentCommissions_0_value").closest('.control-group').hasClass("error")){
                $("#transactionClosing_closing_agentCommissions_0_value").addClass("required");
            }
            if($("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("success") || $("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("error")){
                $("#transactionClosing_closing_totalCommissions_0_value").addClass("required");
            }
            
          {# if ($("#transactionListing_listing_represent").val() === 'Buyer'){
                    {% if app.user.businesses[0].id == 50 %}
                        $("#transactionClosing_closing_buyerContact_address_zip").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_titleCompanyContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerattorneyCompanyContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_phone").addClass("required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_city").addClass("required validate-for-row");
                        
                    {% endif %}
                }#}
                
                {#if ($("#transactionListing_listing_represent").val() === 'Tenant'){
                    {% if app.user.businesses[0].id == 50 %}
                        $("#transactionClosing_closing_buyerContact_address_zip").addClass("required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_city").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_phone").removeClass("donotvalidate");
                        $("#transactionClosing_closing_sellerContact_phone").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_email").removeClass("donotvalidate");
                        $(".sellerPhoneChange").addClass("control-group");
                        $(".sellerEmailChange").addClass("control-group");
                        $("#transactionClosing_closing_sellerContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_totalCommissions_0_value").addClass("required validate-for-row");
                        $("#transactionClosing_closing_buyerAgentCommissions_0_value").addClass("required validate-for-row");
                    {% endif %}
                }#}
            $('#transactionClosing_closing_closingContacts_0_time').on('click',function(e){
                setTimeout(function() {
                    if($("#transactionClosing_closing_closingContacts_0_time").closest('.input-group').hasClass("success")){
                        $("#transactionClosing_closing_closingContacts_0_time").css("background-color","#fff");
                    }
                }, 1000);
            });
            
            $('#transactionClosing_closing_closingContacts_1_time').on('click',function(e){
                setTimeout(function() {
                    if($("#transactionClosing_closing_closingContacts_1_time").closest('.input-group').hasClass("success")){
                        $("#transactionClosing_closing_closingContacts_1_time").css("background-color","#fff");
                    }
                }, 1500);
            }); 
            if($("#transactionClosing_closing_represent").val()=='Landlord&Tenant'){
                    if($("#transactionClosing_closing_buyerContact_address_city").val()!=''){
                        successValidation('transactionClosing_closing_buyerContact_address_city');
                    }
                    else{
                        errorValidation('transactionClosing_closing_buyerContact_address_city');
                    }
                    
                    if($("#transactionClosing_closing_buyerContact_address_street").val()!=''){
                        successValidation('transactionClosing_closing_buyerContact_address_street');
                    }
                    else{
                        errorValidation('transactionClosing_closing_buyerContact_address_street');
                    }
                    
                    if($("#transactionClosing_closing_buyerContact_address_state").val()!=''){
                        successValidation('transactionClosing_closing_buyerContact_address_state');
                    }
                    else{
                        errorValidation('transactionClosing_closing_buyerContact_address_state');
                    }
                    
                    if($("#transactionClosing_closing_buyerContact_address_zip").val()!=''){
                        successValidation('transactionClosing_closing_buyerContact_address_zip');
                    }
                    else{
                        errorValidation('transactionClosing_closing_buyerContact_address_zip');
                    }
                }
        });
    jQuery(document).ready(function() {
        
        
		/*remove color  for  all company */
		$('#transactionClosing_closing_listingAgentContact_company').closest('.control-group').removeClass('error');
		$('#transactionClosing_closing_listingOfficeContact_company').closest('.control-group').removeClass('success');
		$('#transactionClosing_closing_sellerContact_company').closest('.control-group').removeClass('success');
		//$('#transactionClosing_closing_listingOfficeContact_company').closest('.control-group').removeClass('success');
		//$('#transactionClosing_closing_listingOfficeContact_company').closest('.control-group').removeClass('success');
		//$('#transactionClosing_closing_listingOfficeContact_company').closest('.control-group').removeClass('success');
		/* added for  year fiels*/
	    
		$("#transactionClosing_transactionProperty_property_address_zip").on("keypress keyup blur change",function (event) {    
           $(this).val($(this).val().replace(/[^\d].+/, ""));
		    var year = $(this).val();
            if ((event.which < 48 || event.which > 57 || year.length > 4)) {
                event.preventDefault();
            }
        });
		$("#transactionClosing_transactionProperty_yearBuilt").on("keypress keyup blur change",function (event) {    
           $(this).val($(this).val().replace(/[^\d].+/, ""));
		    var year = $(this).val();
            if ((event.which < 48 || event.which > 57 || year.length > 3)) {
                event.preventDefault();
            }
        });
	{#	$("#transactionClosing_closing_totalCommissions_0_value,#transactionClosing_closing_buyerAgentCommissions_0_value").on("keypress keyup change",function (event) {    
           $(this).val($(this).val().replace(/[^\d].+/, ""));
		    var value = $(this).val();
            if ((event.which < 48 || event.which > 57  || value.length > 6 )) {
                event.preventDefault();
            }
        });#}
		
	 $("#closing-submit").click(function () {
		    var represent = $("#transactionClosing_closing_represent").val();
			var errormsg='';
			var errormsg2='';
                        var errormsg3='';
			/* date */
			if($("#transactionClosing_closing_closingContacts_1_time").val() ==""){
				errormsg2='Please Enter Contract Closed Date';
				/* $("#transactionClosing_closing_closingContacts_1_time").css('border-color','red');
				$("#transactionClosing_closing_closingContacts_1_time").css('background-color','#faffbd'); */
				$("#transactionClosing_closing_closingContacts_1_time").closest('.control-group').addClass('error');
				$("#transactionClosing_closing_closingContacts_1_time").closest('.control-group').removeClass('success');
				//$('html, body').animate({scrollTop: $('#transactionClosing_closing_closingContacts_1_time').offset().top}, 'fast');
				 $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				 $("#transactionClosing_closing_closingContacts_1_time").focus();
			}else{
				/* $("#transactionClosing_closing_closingContacts_1_time").css('border-color','#ccc');
				$("#transactionClosing_closing_closingContacts_1_time").css('background-color','#fff'); */
				$('#transactionClosing_closing_closingContacts_1_time').closest('.control-group').addClass('success');
			}
			if($("#transactionClosing_closing_closingContacts_0_time").val() ==""){
				errormsg2='Please Enter Contract Signed Date';
				$("#transactionClosing_closing_closingContacts_0_time").css('border-color','red');
				$("#transactionClosing_closing_closingContacts_0_time").css('background-color','#faffbd');
				$("#transactionClosing_closing_closingContacts_0_time").focus();
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				
			}
			/*financial */
			{% if app.user.businesses[0].id == 50 %}
			   if($("#transactionClosing_closing_buyerAgentCommissions_0_value").val() ==""){
					errormsg2="Please Enter  Buyer's Agent Commission";
					$("#transactionClosing_closing_buyerAgentCommissions_0_value").css('border-color','red');
					$("#transactionClosing_closing_buyerAgentCommissions_0_value").css('background-color','#faffbd');
					$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
					$("#transactionClosing_closing_buyerAgentCommissions_0_value").focus();
					//$('html, body').animate({scrollTop: $('#transactionClosing_closing_buyerAgentCommissions_0_value').offset().top}, 'fast');
				} 
				if($("#transactionClosing_closing_totalCommissions_0_value").val() ==""){
					errormsg2='Please Enter Total Commission .';
					$("#transactionClosing_closing_totalCommissions_0_value").css('border-color','red');
					$("#transactionClosing_closing_totalCommissions_0_value").css('background-color','#faffbd');
					$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
					//$('html, body').animate({scrollTop: $('#transactionClosing_closing_totalCommissions_0_value').offset().top}, 'fast');
					$("#transactionClosing_closing_totalCommissions_0_value").focus();
				} 
		
			{% endif %}
			
			
			if($("#transactionClosing_closing_moneyBox_contractPrice").val() ==""){
				errormsg2='Please Enter Contract Price  ';
				$("#transactionClosing_closing_moneyBox_contractPrice").css('border-color','red');
				$("#transactionClosing_closing_moneyBox_contractPrice").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				$("#transactionClosing_closing_moneyBox_contractPrice").focus();
				//$('html, body').animate({scrollTop: $('#transactionClosing_closing_moneyBox_contractPrice').offset().top}, 'fast');
			}else{
				$("#transactionClosing_closing_moneyBox_contractPrice").css('border-color','#ccc');
				$("#transactionClosing_closing_moneyBox_contractPrice").css('background-color','#fff');
			} 
			
	        /* Property Information */
			if($("#transactionClosing_transactionProperty_property_address_city").val() ==""){
				errormsg2='Please Enter City';
				$("#transactionClosing_transactionProperty_property_address_city").css('border-color','red');
				$("#transactionClosing_transactionProperty_property_address_city").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				//$('html, body').animate({scrollTop: $('#transactionClosing_transactionProperty_property_address_city').offset().top}, 'fast');
				$("#transactionClosing_transactionProperty_property_address_city").focus();
			}else{
				$("#transactionClosing_transactionProperty_property_address_city").css('border-color','#ccc');
				$("#transactionClosing_transactionProperty_property_address_city").css('background-color','#fff');
			} 
			if($("#transactionClosing_transactionProperty_property_address_street").val() ==""){
				errormsg2='Please Enter Property Street Address';
				$("#transactionClosing_transactionProperty_property_address_street").css('border-color','red');
				$("#transactionClosing_transactionProperty_property_address_street").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				$("#transactionClosing_transactionProperty_property_address_street").focus();
				//$('html, body').animate({scrollTop: $('#transactionClosing_transactionProperty_property_address_street').offset().top}, 'fast');
			}else{
				$("#transactionClosing_transactionProperty_property_address_street").css('border-color','#ccc');
				$("#transactionClosing_transactionProperty_property_address_street").css('background-color','#fff');
			} 
			if($("#transactionClosing_transactionProperty_property_address_zip").val() ==""){
				errormsg2='Please Enter Property Street Address';
				$("#transactionClosing_transactionProperty_property_address_zip").css('border-color','red');
				$("#transactionClosing_transactionProperty_property_address_zip").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				$("#transactionClosing_transactionProperty_property_address_zip").focus();
				//$('html, body').animate({scrollTop: $('#transactionClosing_transactionProperty_property_address_zip').offset().top}, 'fast');
			}else{
				$("#transactionClosing_transactionProperty_property_address_zip").css('border-color','#ccc');
				$("#transactionClosing_transactionProperty_property_address_zip").css('background-color','#fff');
			} 			
			if($("#transactionClosing_transactionProperty_property_type").val() ==""){
				errormsg2='Please Enter Property Street Address';
				$("#transactionClosing_transactionProperty_property_type").css('border-color','red');
				$("#transactionClosing_transactionProperty_property_type").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				$("#transactionClosing_transactionProperty_property_type").focus();
				//$('html, body').animate({scrollTop: $('#transactionClosing_transactionProperty_property_type').offset().top}, 'fast');
			}else{
				$("#transactionClosing_transactionProperty_property_type").css('border-color','#ccc');
				$("#transactionClosing_transactionProperty_property_type").css('background-color','#fff');
			} 
			if($("#transactionClosing_transactionProperty_yearBuilt").val() =="" && $("#transactionClosing_transactionProperty_yearBuilt").is(':visible')){
				errormsg2='Please Enter Property Street Address';
				$("#transactionClosing_transactionProperty_yearBuilt").css('border-color','red');
				$("#transactionClosing_transactionProperty_yearBuilt").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				$("#transactionClosing_transactionProperty_yearBuilt").focus();
			}else{
				$("#transactionClosing_transactionProperty_yearBuilt").css('border-color','#ccc');
				$("#transactionClosing_transactionProperty_yearBuilt").css('background-color','#fff');
			} 
			if($("#transactionClosing_transactionProperty_property_type").val() ==""){
				errormsg2='Please Enter Property Type';
				$("#transactionClosing_transactionProperty_property_type").css('border-color','red');
				$("#transactionClosing_transactionProperty_property_type").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				$("#transactionClosing_transactionProperty_property_type").focus();
			}else{
				$("#transactionClosing_transactionProperty_property_type").css('border-color','#ccc');
				$("#transactionClosing_transactionProperty_property_type").css('background-color','#fff');
			}

			if($("#transactionClosing_closing_type").val() =="") {
				errormsg2 = 'Please Enter Transaction Type';
				$("#transactionClosing_closing_type").css('border-color','red');
				$("#transactionClosing_closing_type").css('background-color','#faffbd');
				$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				$("#transactionClosing_closing_type").focus();
			}
			else{
				$("#transactionClosing_closing_type").css('border-color','#ccc');
				$("#transactionClosing_closing_type").css('background-color','#fff');
			}

                        if($("#transactionClosing_closing_represent").val() =="") {
				 errormsg2 = 'Please Enter Client Type';
				 $("#transactionClosing_closing_represent").css('border-color','red');
				 $("#transactionClosing_closing_represent").css('background-color','#faffbd');
				 $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				 $("#transactionClosing_closing_represent").focus();
			 }
			 else{
				 $("#transactionClosing_closing_represent").css('border-color','#ccc');
				 $("#transactionClosing_closing_represent").css('background-color','#fff');
			 }
                         
                        if($("#transactionClosing_transactionProperty_yearBuilt").val().length!=4 && $("#transactionClosing_transactionProperty_property_type").val()!='Vacant_Land') {
				 errormsg2 = 'Year built can be 4 digits only';
				 $("#transactionClosing_transactionProperty_yearBuilt").css('border-color','red');
				 $("#transactionClosing_transactionProperty_yearBuilt").css('background-color','#faffbd');
				 $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
				 $("#transactionClosing_transactionProperty_yearBuilt").focus();
			 }
                         
                        
			if($("#transactionClosing_closing_totalCommissions_0_value").val()!=""){
                            var value= $("#transactionClosing_closing_totalCommissions_0_value").val();
                             if(value!= undefined){
                            var length= value.length;
                            if($("#transactionClosing_closing_totalCommissions_0_type").val()== "%"){
                                if(value.indexOf(".") != -1){
                                    // exists decimal point
                                    var split_length= value.split(".");
                                    var before_length= split_length[0].length;
                                    var after_length= split_length[1].length;
                                    
                                    if(value>100 || value< 0){
                                        errormsg2 = 'Enter correct % of commission, should not more than 100 or less than 0';
                                    }
                                    if(after_length>2){
                                        errormsg2 = 'Commission only allowed up to 2 places of decimal';
                                    }
                                }
                                else{
                                     // not exists decimal point
                                    if(value>100 || value< 0){
                                       errormsg2 = 'Enter correct % of commission, should not more than 100 or less than 0';
                                    }
                                }
                            }
                            else{
                                if(value.indexOf(".") != -1){
                                    var split_length= value.split(".");
                                    var after_length= split_length[1].length;
                                    if(after_length>2){
                                        errormsg2 = 'Commission only allowed up to 2 places of decimal';
                                    }
                                }
                                if(value< 0){
                                    errormsg2 = 'Enter correct $ of commission, should not less than 0';
                                }
                            }
                            if(errormsg2!=''){
                                setTimeout(function() {
                                    $("#transactionClosing_closing_totalCommissions_0_value").closest(".control-group").removeClass("success");
                                    $("#transactionClosing_closing_totalCommissions_0_value").closest(".control-group").addClass("error");
                                    $("#transactionClosing_closing_totalCommissions_0_value").css('border-color','red');
                                    $("#transactionClosing_closing_totalCommissions_0_value").css('background-color','#faffbd');
                                }, 800);
				$("#transactionClosing_closing_totalCommissions_0_value").focus();
                            }
                        }
                        }
			
                        if($("#transactionClosing_closing_agentCommissions_0_value").val()!=""){
                            var value= $("#transactionClosing_closing_agentCommissions_0_value").val();
                            if(value!= undefined){
                            var length= value.length;
                            if($("#transactionClosing_closing_agentCommissions_0_type").val()== "%"){
                                if(value.indexOf(".") != -1){
                                    // exists decimal point
                                    var split_length= value.split(".");
                                    var before_length= split_length[0].length;
                                    var after_length= split_length[1].length;
                                    
                                    if(value>100 || value< 0){
                                        errormsg = 'Enter correct % of commission, should not more than 100 or less than 0';
                                    }
                                    if(after_length>2){
                                        errormsg = 'Commission only allowed up to 2 places of decimal';
                                    }
                                }
                                else{
                                     // not exists decimal point
                                    if(value>100 || value< 0){
                                       errormsg = 'Enter correct % of commission, should not more than 100 or less than 0';
                                    }
                                }
                            }
                            else{
                                if(value.indexOf(".") != -1){
                                    var split_length= value.split(".");
                                    var after_length= split_length[1].length;
                                    if(after_length>2){
                                        errormsg = 'Commission only allowed up to 2 places of decimal';
                                    }
                                }
                                if(value< 0){
                                    errormsg = 'Enter correct $ of commission, should not less than 0';
                                }
                            }
                            if(errormsg!=''){
                                setTimeout(function() {
                                    $("#transactionClosing_closing_agentCommissions_0_value").closest(".control-group").removeClass("success");
                                    $("#transactionClosing_closing_agentCommissions_0_value").closest(".control-group").addClass("error");
                                    $("#transactionClosing_closing_agentCommissions_0_value").css('border-color','red');
                                    $("#transactionClosing_closing_agentCommissions_0_value").css('background-color','#faffbd');
                                }, 800);
				$("#transactionClosing_closing_agentCommissions_0_value").focus();
                            }
                        }
                        }
                        
                        if($("#transactionClosing_closing_buyerAgentCommissions_0_value").val()!=""){
                            var value= $("#transactionClosing_closing_buyerAgentCommissions_0_value").val();
                             if(value!= undefined){
                            var length= value.length;
                            if($("#transactionClosing_closing_buyerAgentCommissions_0_type").val()== "%"){
                                if(value.indexOf(".") != -1){
                                    // exists decimal point
                                    var split_length= value.split(".");
                                    var before_length= split_length[0].length;
                                    var after_length= split_length[1].length;
                                    
                                    if(value>100 || value<0){
                                        errormsg3 = 'Enter correct % of commission, should not more than 100 or less than 0';
                                    }
                                    if(after_length>2){
                                        errormsg3 = 'Commission only allowed up to 2 places of decimal';
                                    }
                                }
                                else{
                                     // not exists decimal point
                                    if(value>100 || value< 0){
                                       errormsg3 = 'Enter correct % of commission, should not more than 100 or less than 0';
                                    }
                                }
                            }
                            else{
                                if(value.indexOf(".") != -1){
                                    var split_length= value.split(".");
                                    var after_length= split_length[1].length;
                                    if(after_length>2){
                                        errormsg3 = 'Commission only allowed up to 2 places of decimal';
                                    }
                                }
                                if(value< 0){
                                    errormsg3 = 'Enter correct $ of commission, should not less than 0';
                                }
                            }
                            if(errormsg3!=''){
                                setTimeout(function() {
                                    $("#transactionClosing_closing_buyerAgentCommissions_0_value").closest(".control-group").removeClass("success");
                                    $("#transactionClosing_closing_buyerAgentCommissions_0_value").closest(".control-group").addClass("error");
                                    $("#transactionClosing_closing_buyerAgentCommissions_0_value").css('border-color','red');
                                    $("#transactionClosing_closing_buyerAgentCommissions_0_value").css('background-color','#faffbd');
                                }, 800);
				$("#transactionClosing_closing_buyerAgentCommissions_0_value").focus();
                            }
                        }
                        }
                         
            			
			if(represent==='Tenant'){
				$("#trans_contacts_wrapper").find('input') .each(function() {
                                    if($(this).closest('.required_party').css('display') != 'none'){
				    var value= $(this).val();
					var id = $(this).attr("id");
					if (id == null){
					   //do nothing
					}else{
					   if ((id.indexOf('_company') >= 0) || (id.indexOf('buyerContact2') >= 0)){ 
							//Company title  not required 
							//alert("_company _transactionListing_listing_titleCompany");
						   if((id=='transactionClosing_closing_titleCompanyContact_company')|| (id=='transactionClosing_closing_sellerattorneyCompanyContact_company')){
								if(( value==="") || (value === null)){
									/* $('#'+id).css('border-color','red');
								    $('#'+id).css('background-color','#faffbd'); */
									$('#'+id).closest('.control-group').addClass('error');
									$('#'+id).closest('.control-group').removeClass('success');
                                                                        errorValidation(id);
								    errormsg='Please Enter all the  Required Fields ';
								    $('#'+id).focus();
									$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
								    return false;
								}else{
								  // errormsg='';
								    /* $('#'+id).css('border-color','#ccc');
									$('#'+id).css('background-color','#fff'); */
									$('#'+id).closest('.control-group').addClass('success');
                                                                        successValidation(id);
								}
						   }else{
								//errormsg='';
                                                            if((id=='transactionClosing_closing_listingAgentContact_company')|| (id=='transactionClosing_closing_listingOfficeContact_company') || (id=='transactionClosing_closing_buyerContact_address_zip')){
                                                                if(( value==="") || (value === null)){
                                                                 errorValidation(id);
                                                                }
                                                                else{
                                                                    successValidation(id); 
                                                                }
                                                            }
                                                            else{
                                                                noValidation(id); 
                                                                if(value !=""){
                                                                if (id.indexOf('zip') >= 0) {
                                                                    var numregex = /^[0-9]+$/;
                                                                    if (!value.match(numregex)){
                                                                            errormsg ="Numeric Data Only for  Zip";
                                                                            //$('#'+id).css('border-color','red');
                                                                            //$('#'+id).css('background-color','#faffbd');
                                                                            $('#'+id).focus();
                                                                            $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                            //return false;
                                                                    }else{
                                                                        if(value.length!=5){
                                                                            errormsg ="Zip code should be of 5 digits";
                                                                            $('#'+id).focus();
                                                                            $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                        }
                                                                    }
                                                                }
                                                    
                                                                if (id.indexOf('email') >= 0) {
                                                                    var valemail = validateEmail(value);
                                                                    if(!valemail){
                                                                        errormsg ="Please Validate Email";
                                                                        $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                        $('#'+id).focus();
                                                                    }
                                                                }
                                                    
                                                                if (id.indexOf('phone') >= 0) {
                                                                    var phonestr = value.replace ( /[^\d.]/g, '' ); 
                                                                    if(phonestr.length >= 7){

                                                                    }else{
                                                                        $('#'+id).focus();
                                                                        var idd =id.split('_');
                                                                        var msg =idd[2];
                                                                        errormsg ="Minimum Required digits 7  for phone no.";
                                                                        $('#'+id).focus();
                                                                        $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                        //return false;
                                                                    } 
                                                                }}
                                                                else{
                                                                 errormsg="";
                                                                }
                                                            }
						   }
						}else{
							
							if(( value==="") || (value === null)){
                                                            if($('#'+id).hasClass("donotvalidate")){
                                                                errormsg='';
                                                            }
                                                            else{
							  /*  $('#'+id).css('border-color','red');
							   $('#'+id).css('background-color','#faffbd!important'); */
                                                                $('#'+id).closest('.control-group').addClass('error');
                                                                $('#'+id).closest('.control-group').removeClass('success');
                                                                $('#'+id).closest('.lisa').addClass('error');
                                                                $('#'+id).closest('.lisa').removeClass('success');
                                                                errorValidation(id);
                                                                errormsg='Please Enter all the  Required Fields ';
                                                                $('#'+id).focus();
                                                                $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                            }
							   return false;
						    }else{
							   //errormsg='';
							   //$('#'+id).css('border-color','#ccc');
							   //$('#'+id).css('background-color','#fff');
							   if (id.indexOf('email') >= 0) {
									var valemail = validateEmail(value);
									if(valemail==true){
										/* $('#'+id).css('border-color','#ccc');
										$('#'+id).css('background-color','#fff'); */
										$('#'+id).closest('.control-group').addClass('success');
                                                                                successValidation(id);
									}else{
										/* $('#'+id).css('border-color','red');
										$('#'+id).css('background-color','#faffbd'); */
										$('#'+id).closest('.control-group').addClass('error');
										$('#'+id).closest('.control-group').removeClass('success');
										$('#'+id).focus();
                                                                                errorValidation(id);
										//$('html, body').animate({scrollTop: $('#'+id).offset().top}, 'fast');
										errormsg ="Please Validate Email";
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
										return false;
									}
								} 
								if (id.indexOf('zip') >= 0) {
									var numregex = /^[0-9]+$/;
									if (!value.match(numregex)){
										errormsg ="Numeric Data Only for  Zip";
										/* $('#'+id).css('border-color','red');
										$('#'+id).css('background-color','#faffbd'); */
										$('#'+id).closest('.control-group').addClass('error');
										$('#'+id).closest('.control-group').removeClass('success');
										$('#'+id).focus();
                                                                                errorValidation(id);
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
										return false;
									}else{
										if(value.length!=5){
                                                                                errormsg ="Zip code should be of 5 digits";
                                                                                $('#'+id).closest('.control-group').addClass('error');
                                                                                $('#'+id).closest('.control-group').removeClass('success');
                                                                                errorValidation(id);
										$('#'+id).focus();
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                            }
                                                                            else{
										/* $('#'+id).css('border-color','#ccc');
										$('#'+id).css('background-color','#fff'); */
										$('#'+id).closest('.control-group').addClass('success');
                                                                                successValidation(id);
                                                                            }
									}
								}
								if (id.indexOf('phone') >= 0) {
									var phonestr = value.replace ( /[^\d.]/g, '' ); 
									if(phonestr.length >= 7){
										/* $('#'+id).css('border-color','#ccc');
										$('#'+id).css('background-color','#fff'); */
										$('#'+id).closest('.control-group').addClass('success');
                                                                                successValidation(id);
										
									}else{
										$('#'+id).focus();
										/* $('#'+id).css('border-color','red');
										$('#'+id).css('background-color','#faffbd'); */
										$('#'+id).closest('.control-group').addClass('error');
										$('#'+id).closest('.control-group').removeClass('success');
                                                                                errorValidation(id);
										var idd =id.split('_');
										var msg =idd[2];
										errormsg ="Minimum Required digits 7  for phone no.";
                                                                                $('#'+id).focus();
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
										return false;
									} 
								}
						    }
						}
					}
                                    }
				});
			}else{ 
				$("#trans_contacts_wrapper").find('input') .each(function() {
                                    if($(this).closest('.required_party').css('display') != 'none'){
					var value= $(this).val();
					var id = $(this).attr("id");
					
					if (id == null){
						// id not defined or undefined
						//do nothing
						//errormsg='';
					}else{
					  //transactionClosing_closing_sellerattorneyCompanyContact_contactName
					   if ((id.indexOf('_company') >= 0) || (id.indexOf('buyerContact2') >= 0) ||(id.indexOf('escrowCompanyContact') >=0) ||(id.indexOf('lenderContact') >= 0) || (id.indexOf('homeInsuranceContact') >=0) || (id.indexOf('homeInspectorContact') >=0)){
                            if((id=='transactionClosing_closing_titleCompanyContact_company')|| (id=='transactionClosing_closing_sellerattorneyCompanyContact_company')){
								if(( value==="") || (value === null)){
                                                                    if($('#'+id).hasClass("donotvalidate")){
                                                                        errormsg='';
                                                                    }
                                                                    else{
									/* $('#'+id).css('border-color','red');
								    $('#'+id).css('background-color','#faffbd'); */
									$('#'+id).closest('.control-group').addClass('error');
									$('#'+id).closest('.control-group').removeClass('success');
                                                                        errormsg='Please Enter all the  Required Fields ';
                                                                        errorValidation(id);
								    $('#'+id).focus();
									$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                    }
								    return false;
								}else{
								   //errormsg='';
								    /* $('#'+id).css('border-color','#ccc');
									$('#'+id).css('background-color','#fff'); */
									$('#'+id).closest('.control-group').addClass('success');
                                                                        successValidation(id);
								}
						   }else{                                                                                          
								//errormsg='';
								/* $('#'+id).css('border-color','#ccc');
							    $('#'+id).css('background-color','#fff'); */
                                                            {% if app.user.businesses[0].id == 50 %}
                                                            if((id=='transactionClosing_closing_listingAgentContact_company')|| (id=='transactionClosing_closing_listingOfficeContact_company') || (id=='transactionClosing_closing_buyerContact_address_zip')){
                                                                if(( value==="") || (value === null)){
                                                                 errorValidation(id);
                                                                }
                                                                else{
                                                                    successValidation(id); 
                                                                }
                                                            }
                                                            else{
                                                                noValidation(id); 
                                                                if(value !=""){
                                                                if (id.indexOf('zip') >= 0) {
                                                                    var numregex = /^[0-9]+$/;
                                                                    if (!value.match(numregex)){
                                                                            errormsg ="Numeric Data Only for  Zip";
                                                                            //$('#'+id).css('border-color','red');
                                                                            //$('#'+id).css('background-color','#faffbd');
                                                                            $('#'+id).focus();
                                                                            $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                            return false;
                                                                    }else{
                                                                        if(value.length!=5){
                                                                            errormsg ="Zip code should be of 5 digits";
                                                                            $('#'+id).focus();
                                                                            $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                        }
                                                                    }
                                                                }
                                                    
                                                                if (id.indexOf('email') >= 0) {
                                                                    var valemail = validateEmail(value);
                                                                    if(!valemail){
                                                                        errormsg ="Please Validate Email";
                                                                        $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                        $('#'+id).focus();
                                                                        return false;
                                                                    }
                                                                }
                                                    
                                                                if (id.indexOf('phone') >= 0) {
                                                                    var phonestr = value.replace ( /[^\d.]/g, '' ); 
                                                                    if(phonestr.length >= 7){

                                                                    }else{
                                                                        $('#'+id).focus();
                                                                        var idd =id.split('_');
                                                                        var msg =idd[2];
                                                                        errormsg ="Minimum Required digits 7  for phone no.";
                                                                        $('#'+id).focus();
                                                                        $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                        return false;
                                                                    } 
                                                                }
                                                            }
                                                            }
                                                            {% else %}
                                                                errormsg='';
                                                            {% endif %}
                                                            
						   }
						}else{
							if(( value==="") || (value === null)){
                                                            if($('#'+id).hasClass("donotvalidate")){
                                                                errormsg='';
                                                            }
                                                            else{
							   //alert(id);
                                                                /*   $('#'+id).css('border-color','red');
                                                                $('#'+id).css('background-color','#faffbd'); */
                                                                $('#'+id).closest('.control-group').addClass('error');
								$('#'+id).closest('.control-group').removeClass('success');
                                                                errorValidation(id);
                                                                $('#'+id).focus();
                                                                // $('html, body').animate({scrollTop: $('#'+id).offset().top}, 'fast');
                                                                errormsg='Please Enter all the  Required Fields ';
                                                                $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                            }
							   return false;
						   }else{
							   //errormsg='';
							  // $('#'+id).css('background-color','#fff');
							   if (id.indexOf('email') >= 0) {
									var valemail = validateEmail(value);
									if(valemail==true){
										$('#'+id).css('border-color','#ccc');
										$('#'+id).css('background-color','#fff');
									}else{
                                                                            if($('#'+id).hasClass("donotvalidate")){
                                                                                 errormsg='';
                                                                            } 
                                                                            else{
										/* $('#'+id).css('border-color','red');
										$('#'+id).css('background-color','#faffbd'); */
										$('#'+id).closest('.control-group').addClass('error');
                                                                                $('#'+id).closest('.control-group').removeClass('success');
                                                                                errorValidation(id);
										$('#'+id).focus();
										//$('html, body').animate({scrollTop: $('#'+id).offset().top}, 'fast');
										errormsg ="Please Validate Email";
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                            }
										return false;
									}
								}
								
								if (id.indexOf('zip') >= 0) {
									var numregex = /^[0-9]+$/;
									if (!value.match(numregex)){
										errormsg ="Numeric Data Only for  Zip";
										/* $('#'+id).css('border-color','red');
										$('#'+id).css('background-color','#faffbd'); */
										$('#'+id).closest('.control-group').addClass('error');
                                                                                $('#'+id).closest('.control-group').removeClass('success');
                                                                                errorValidation(id);
										$('#'+id).focus();
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
										return false;
									}else{
                                                                            if(value.length!=5){
                                                                                errormsg ="Zip code should be of 5 digits";
                                                                                $('#'+id).closest('.control-group').addClass('error');
                                                                                $('#'+id).closest('.control-group').removeClass('success');
                                                                                errorValidation(id);
										$('#'+id).focus();
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                                                                            }
                                                                            else{
										/* $('#'+id).css('border-color','#ccc');
										$('#'+id).css('background-color','#fff'); */
										$('#'+id).closest('.control-group').addClass('success');
                                                                                successValidation(id);
                                                                            }
									}
								}
								if (id.indexOf('phone') >= 0) {
									var phonestr = value.replace ( /[^\d.]/g, '' ); 
									if(phonestr.length >= 7){
										/* $('#'+id).css('border-color','#ccc');
										$('#'+id).css('background-color','#fff'); */
										$('#'+id).closest('.control-group').addClass('success');
                                                                                successValidation(id);
									}else{
										$('#'+id).focus();
										/* $('#'+id).css('border-color','red');
										$('#'+id).css('background-color','#faffbd'); */
										$('#'+id).closest('.control-group').addClass('error');
                                                                                $('#'+id).closest('.control-group').removeClass('success');
                                                                                errorValidation(id);
										
										var idd =id.split('_');
										var msg =idd[2];
										errormsg ="Minimum Required digits 7  for phone no.";
                                                                                $('#'+id).focus();
										$('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
										return false;
									} 
								}
								
						   }
							
					    }
					}
                                    }
				});
			} //  else selleror any  other  closed. 
			//alert("going  for submit ");
			//alert(errormsg);
			if((errormsg!=='') || (errormsg2!=='') || (errormsg3!=='')){
				if(errormsg!==''){
				  alert(errormsg);
				}else{
                                    if(errormsg2!==''){
                                        alert(errormsg2);
                                    }
                                    else{
                                        alert(errormsg3);
                                    }
					//alert("Please Enter all the  Required Fields");
				}
                if($('#transactionClosing_closing_moneyBox_paymentType').val()){
                  //  console.log("inside");
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').removeClass('error');
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').addClass('success');

                }else{
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').removeClass('success');
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').addClass('error');

                }
				return false;
			}
		});
		function validateEmail(Email) {
			var pattern = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
			return $.trim(Email).match(pattern) ? true : false;
		} 
	});
	</script>
	
    {% if app.user.businesses[0].id == 50 %}
        <script>
            $(document).ready(function () {
                // $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('error');
                // $('#transactionClosing_closing_titleCompanyContact_contactName').removeClass('required validate-for-row');
                // $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').removeClass('error');
                // $('#transactionClosing_closing_titleCompanyContact_phone').removeClass('required validate-for-row');
                //
                //$('#transactionClosing_closing_buyerContact_email').closest('.control-group').removeClass('error');
                //$('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_listingAgentContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_listingAgentContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_listingOfficeContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_listingOfficeContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_sellerContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_sellerContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_sellerContact_phone').removeClass('required validate-for-row');
                $('#transactionClosing_closing_buyersAgentContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_buyersAgentContact_email').removeClass('required validate-for-row');
            });
        </script>
    {% endif %}

    <script>
		var initPage = true;
        var companyName = '';
        var companyPhone = '';
        var companyEmail = '';
        var companyContactName = '';
        {% for business in app.user.businesses %}
        {% if business.id == app.session.get('current_business') %}
        companyName = "{{ business.name }}".replace(/&amp;/g, '&');
        {% if business.contact.phones.first %}
        companyPhone = "{{ business.contact.phones.first.number }}";
        {% endif %}
        {% if business.contact.emails.first %}
        companyEmail = "{{ business.contact.emails.first.email }}";
        {% endif %}
        {% if business.contactName %}
        companyContactName = "{{ business.contactName }}";
        {% endif %}
        {% endif %}
        {% endfor %}
        function prefilBuyersAgentRow() {
            $('#transactionClosing_closing_buyersAgentContact_contactName').val("{% if creatorAgent is not null %}{{ creatorAgent.firstname }} {{ creatorAgent.lastname }}{% else %}{{ app.user.firstname }} {{ app.user.lastname }}{% endif %}").closest('.control-group').removeClass('error').addClass('success');
            $('#transactionClosing_closing_buyersAgentContact_phone').val("{% if creatorAgent is not null %}{{ creatorAgent.primaryPhone.number }}{% else %}{{ app.user.primaryPhone.number }}{% endif %}").closest('.control-group').removeClass('error').addClass('success');
            $('#transactionClosing_closing_buyersAgentContact_email').val("{% if creatorAgent is not null %}{{ creatorAgent.primaryEmail.email }}{% else %}{{ app.user.primaryEmail.email }}{% endif %}").closest('.control-group').removeClass('error').addClass('success');
            $('#transactionClosing_closing_buyersAgentContact_company').val(companyName).closest('.control-group').removeClass('error').addClass('success');
            $('.buyerAgent .typeahead').typeahead('val',"{% if creatorAgent is not null %}{{ creatorAgent.firstname }} {{ creatorAgent.lastname }}{% else %}{{ app.user.firstname }} {{ app.user.lastname }}{% endif %}");
        }
        prefilBuyersAgentRow();
        function prefilBuyersOfficeRow() {
            {#{% if closingId %}#}
            {#return false;#}
            {#{% endif %}#}
            $('#transactionClosing_closing_buyersOfficeContact_contactName').val(companyContactName).closest('.control-group').removeClass('error').addClass('success');
            $('#transactionClosing_closing_buyersOfficeContact_phone').val(companyPhone).closest('.control-group').removeClass('error').addClass('success');
            $('#transactionClosing_closing_buyersOfficeContact_email').val(companyEmail).closest('.control-group').removeClass('error').addClass('success');
            $('#transactionClosing_closing_buyersOfficeContact_company').val(companyName).closest('.control-group').removeClass('error').addClass('success');
        }
        function clearBuyersAgentRow() {
            {#{% if closingId %}#}
            {#return false;#}
            {#{% endif %}#}
            $('#transactionClosing_closing_buyersAgentContact_contactName').val('').closest('.control-group').removeClass('success').addClass('error');
            $('#transactionClosing_closing_buyersAgentContact_phone').val('').closest('.control-group').removeClass('success').addClass('error');
            $('#transactionClosing_closing_buyersAgentContact_email').val('').closest('.control-group').removeClass('success').addClass('error');
            $('#transactionClosing_closing_buyersAgentContact_company').val('').closest('.control-group').removeClass('success').addClass('error');
        }
        function clearBuyersOfficeRow() {
            {#{% if closingId %}#}
            {#return false;#}
            {#{% endif %}#}
            $('#transactionClosing_closing_buyersOfficeContact_contactName').val('').closest('.control-group').removeClass('success').addClass('error');
            $('#transactionClosing_closing_buyersOfficeContact_phone').val('').closest('.control-group').removeClass('success').addClass('error');
            $('#transactionClosing_closing_buyersOfficeContact_email').val('').closest('.control-group').removeClass('success').addClass('error');
            $('#transactionClosing_closing_buyersOfficeContact_company').val('').closest('.control-group').removeClass('success').addClass('error');
        }
        function toggleBuyerRow(status) {

            // commented we  no longer need disable option

            {#{% if closingId %}#}
                {#return false;#}
            {#{% endif %}#}

            /*
            $('#transactionClosing_closing_buyerContact_contactName').prop('disabled', status);
            $('#transactionClosing_closing_buyerContact_phone').prop('disabled', status);
            $('#transactionClosing_closing_buyerContact_email').prop('disabled', status);
            $('#transactionClosing_closing_buyerContact_company').prop('disabled', status);
            */
        }
        function checkContactRow(selector) {
            var row = selector;
            //var asterisk = selector.children().first();
           
            if(row.css('display')!='none'){
            row.children().each(function (index, td) {
                td = $(td);
                if (td.find('input:enabled.validate-for-row').val() == '') {
                    row.addClass('contact_error');
                    row.removeClass('contact_success');
                    return false;
                }
                row.removeClass('contact_error');
                row.addClass('contact_success');
            });
            }
        }
        $(document).ready(function () {
            $(".js-data-example-ajax").select2({
                width: '100%',
                minimumInputLength: 1,
                placeholder: "Search Agents",
                ajax: {
                    method: 'GET',
                    url: "/company-agents",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            query: params.term, // search term
                            page: params.page
                        };
                    },
                    processResults: function (data, params) {
                        params.page = params.page || 1;
                        return {
                            results: data.items,
                            pagination: {
                                more: (params.page * 30) < data.total_count
                            }
                        };
                    },
                    cache: true
                },
                escapeMarkup: function (markup) {
                    return markup;
                },
                templateResult: function (data) {
                    if (data.loading) return data.name;
                    markup = "<div class='row' style='margin: 0;'>" +
                        "<div class='col-sm-4'><img style='max-height:62px;' src='" + data.profilepic + "'></div>" +
                        "<div class='col-sm-8'>" +
                        "<h4 style='margin-top: 0;'>" + data.contactName + "</h4>" +
                        "<p style='margin-bottom: 0;'>" +
                        data.phone + "<br>" +
                        data.email +
                        "</p>" +
                        "</div>" +
                        "</div>";
                    return markup;
                },
                templateSelection: function (data) {
                    if (data.contactName == undefined) {
                        return data.text;
                    } else {
                        return data.contactName;
                    }
                }
            })
                .on("select2:select", function (e) {
                    var item = e.params.data;
                    $("#buyerAgentId").val(item.contactName);
                    $('#transactionClosing_closing_buyersAgentContact_contactName').val(item.contactName);
                    $('#transactionClosing_closing_buyersAgentContact_email').val(item.email);
                    $('#transactionClosing_closing_buyersAgentContact_phone').val(item.phone);
                    if (typeof agentBuyerJson != 'undefined' && agentBuyerJson instanceof  Bloodhound) {
                        $('.buyer .typeahead').typeahead('destroy');
                    }
                    {% verbatim %}
                    agentBuyerJson = new Bloodhound({
                        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                        queryTokenizer: Bloodhound.tokenizers.whitespace,
                        remote: {
                            url: "/agent-contacts?agent=" + item.id + "&query=%QUERY",
                            wildcard: "%QUERY"
                        }
                    });
                    agentBuyerJson.initialize();
                    $('.buyer .typeahead').typeahead(null, {
                        name: 'best-pictures',
                        displayKey: 'contactName',
                        source: agentBuyerJson.ttAdapter(),
                        templates: {
                            suggestion: Handlebars.compile([
                                '<div class="media">',
                                '<div class="pull-left">',
                                '<div class="media-object">',
                                '<img src="{{ profilepic }}" width="50" height="50"/>',
                                '</div>',
                                '</div>',
                                '<div class="media-body">',
                                '<h4 class="media-heading">{{contactName}}</h4>',
                                '</div>',
                                '</div>'
                            ].join(''))
                        }
                    }).on('typeahead:selected', function (e, item) {
                        $('.buyer .typeahead').val(item.contactName);
                        $('#transactionClosing_closing_buyerContact_email').val(item.email);
                        $('#transactionClosing_closing_buyerContact_phone').val(item.phone);
                    });
                    {% endverbatim %}
                });
            {% if app.user.role.id == 7 %}
            {% endif %}
            agentBuyerJson = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/agent-contacts?agent={{ app.user.id }}&query=%QUERY",
                    wildcard: "%QUERY"
                }
            });
            agentBuyerJson.initialize();
            {% verbatim %}
            $('.buyer .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'contactName',
                source: agentBuyerJson.ttAdapter(),
                templates: {
                    suggestion: Handlebars.compile([
                        '<div class="media">',
                        '<div class="pull-left">',
                        '<div class="media-object">',
                        '<img src="{{ profilepic }}" width="50" height="50"/>',
                        '</div>',
                        '</div>',
                        '<div class="media-body">',
                        '<h4 class="media-heading">{{ contactName }}</h4>',
                        '</div>',
                        '</div>',
                    ].join(''))
                }
            }).on('typeahead:selected', function (e, item) {
                $('.buyer .typeahead').val(item.contactName);
                $('#transactionClosing_closing_buyerContact_email').val(item.email);
                $('#transactionClosing_closing_buyerContact_phone').val(item.phone);
            });
            {% endverbatim %}
        });
        $(function () {
            {% if app.user.businesses[0].id == 15 %}
            $(".phone").inputmask("999.999.9999");
            {% else %}
            $(".phone").inputmask("(999) 999-9999");
            $("#transactionClosing_closing_status option[value='Active_with_Contract']").remove();
            {% endif %}
            //Uppercase for state field
            $('#transactionClosing_transactionProperty_property_address_state').keyup(function () {
                $(this).val($(this).val().toUpperCase());
            });
            {% if app.user.businesses[0].id == 54 %}
				$("#transactionClosing_closing_represent option[value='Tenant']").hide();
				$("#transactionClosing_closing_type option[value='Lease']").hide();
            {% endif %}
            $(".question").on('click', function () {
                obj = $(this).parent().parent().parent().parent().parent().parent().find('i.fa');
                obj.css('color', 'green');
            });
            $("#transactionClosing_closing_buyersAgentContact_contactName").on('input', function () {
                if (this.value == '') {
                    toggleBuyerRow(true);
                    $('#buyerAgentId').val('');
                } else {
                    toggleBuyerRow(false);
                }
            });
            $("input.required").keyup(function () {
                if ($(this).val() === '') {
                    $(this).closest('.control-group').removeClass('success').addClass('error');
                }
            });
            // Event handler for add button in the alerts row
            $(".add-event-alert2").click(function () {
                $(this).closest("tr.event-alerts-row").prev().find('a.add-event-alert').click();
            });
            // Deposit handler for add button in the alerts row
            $(".add-deposit-alert2").click(function () {
                $(this).closest("tr.deposit-alerts-row").prev().find('a.add-deposit-alert').click();
            });
            $(".trans_contacts input").on('keyup keypress blur change', function () {
                {% if app.user.businesses[0].id == 50 %}
                var id= $(this).attr("id");
                var option= $('#transactionClosing_closing_represent').val();
                quickfixcolor(id,option); // added ^%
                {% endif %}
                checkContactRow($(this).closest('tr'));
            });
            {% if listingRepresent is not null and listingRepresent == 'Landlord' %}
            $('.change_buyer_by_represent').html('Tenant');
            {% elseif listingRepresent is not null and listingRepresent == 'Seller' %}
                $('.change_buyer_by_represent').html('Buyer');
                $('.sellerEmailChange').removeClass('control-group');
                $('.sellerPhoneChange').removeClass('control-group');
                
                $("#transactionClosing_closing_sellerContact_phone").removeClass("required validate-for-row");
                $("#transactionClosing_closing_sellerContact_phone").addClass("donotvalidate");
                 $("#transactionClosing_closing_sellerContact_email").removeClass("required validate-for-row");
                $("#transactionClosing_closing_sellerContact_email").addClass("donotvalidate");
                
                //$('#transactionClosing_closing_buyerContact_email').removeClass('required');
                $('#transactionClosing_closing_buyersAgentContact_email').removeClass('required');
            {%endif%}
            {% if represent is not null and represent == 'Seller'%}
            $('#transactionClosing_closing_represent').append(new Option('Seller', 'Seller', true, true));
            $('#transactionClosing_closing_represent').append(new Option('Buyer&Seller', 'Buyer&Seller', false));
            $("#transactionClosing_closing_represent option[value='Buyer']").hide();
            $("#transactionClosing_closing_represent option[value='Tenant']").hide();
            {% elseif listingRepresent is not null and represent is not null and represent == 'Buyer'%}
            $('#transactionClosing_closing_represent').append(new Option('Seller', 'Seller', false));
            $('#transactionClosing_closing_represent').append(new Option('Buyer&Seller', 'Buyer&Seller', true, true));
            $("#transactionClosing_closing_represent option[value='Buyer']").hide();
            $("#transactionClosing_closing_represent option[value='Tenant']").hide();
            {% elseif represent is not null and represent == 'Buyer&Seller'%}
            $('#transactionClosing_closing_represent').append(new Option('Seller', 'Seller', false));
            $('#transactionClosing_closing_represent').append(new Option('Buyer&Seller', 'Buyer&Seller', true, true));
            $("#transactionClosing_closing_represent option[value='Buyer']").hide();
            $("#transactionClosing_closing_represent option[value='Tenant']").hide();
            {% elseif represent is not null and represent == 'Landlord'%}
            $('#transactionClosing_closing_represent').append(new Option('Landlord', 'Landlord', true, true));
            $('#transactionClosing_closing_represent').append(new Option('Landlord&Tenant', 'Landlord&Tenant', false));
            $("#transactionClosing_closing_represent option[value='Buyer']").hide();
            $("#transactionClosing_closing_represent option[value='Tenant']").hide();
            {% elseif listingRepresent is not null and represent is not null and represent == 'Tenant'%}
            $('#transactionClosing_closing_represent').append(new Option('Landlord', 'Landlord', false));
            $('#transactionClosing_closing_represent').append(new Option('Landlord&Tenant', 'Landlord&Tenant', true, true));
            $("#transactionClosing_closing_represent option[value='Buyer']").hide();
            $("#transactionClosing_closing_represent option[value='Tenant']").hide();
            {% elseif represent is not null and represent == 'Landlord&Tenant'%}
            $('#transactionClosing_closing_represent').append(new Option('Landlord', 'Landlord', false));
            $('#transactionClosing_closing_represent').append(new Option('Landlord&Tenant', 'Landlord&Tenant', true, true));
            $("#transactionClosing_closing_represent option[value='Buyer']").hide();
            $("#transactionClosing_closing_represent option[value='Tenant']").hide();
            {% endif %}
            {% if advancedCommissionBox != true %}
            $('.advanced_1').addClass('hidden');
            $('.regular_commission').addClass('hidden');
            $('.advancedBox_1').html('&');
            $('#transactionClosing_closing_totalCommissions_1_type').val('$');
            $('#transactionClosing_closing_buyerAgentCommissions_1_type').val('$');
            {% endif %}
            if ($('#transactionClosing_closing_closingContacts_0_title').val() == '') {
                $('#transactionClosing_closing_closingContacts_0_title').val('Contract Signed');
            }
            if ($('#transactionClosing_closing_closingContacts_1_title').val() == '') {
                $('#transactionClosing_closing_closingContacts_1_title').val('Closing Date');
            }
            if ($('#transactionClosing_closing_closingContacts_2_title').val() == '') {
                $('#transactionClosing_closing_closingContacts_2_title').val('Deposit');
            }
            if ($('#transactionClosing_closing_closingContacts_3_title').val() == '') {
                $('#transactionClosing_closing_closingContacts_3_title').val('Insurance');
            }
            if ($('#transactionClosing_closing_closingContacts_4_title').val() == '') {
                $('#transactionClosing_closing_closingContacts_4_title').val('Inspection');
            }
            if ($('#transactionClosing_closing_closingContacts_5_title').val() == '') {
                $('#transactionClosing_closing_closingContacts_5_title').val('Loan');
            }
            if ($("select#transactionClosing_closing_moneyBox_paymentType").val() != 'Loan') {
                $('#transactionClosing_closing_closingContacts_5').addClass('hidden');
                $('#alert_transactionClosing_closing_closingContacts_5').addClass('hidden');
            }
            if ($("#transactionClosing_closing_moneyBox_loan_0").attr("checked") || $("#transactionClosing_closing_moneyBox_loan_1").attr("checked")) {
                $('.loanQuestion').css('color', 'green');
            } else {
                $('.loanQuestion').css('color', 'red');
            }
            if ($("#transactionClosing_closing_moneyBox_referral_0").attr("checked") || $("#transactionClosing_closing_moneyBox_referral_1").attr("checked")) {
                $('.referralQuestion').css('color', 'green');
            } else {
                $('.referralQuestion').css('color', 'red');
            }
            if ($("#transactionClosing_closing_hoa_0").attr("checked") || $("#transactionClosing_closing_hoa_1").attr("checked")) {
                $('.hoaQuestion').css('color', 'green');
            } else {
                $('.hoaQuestion').css('color', 'red');
            }
            if ($('#transactionClosing_closing_represent').val() === 'Seller') {

                {% if app.user.businesses[0].id != 50 %}
                $('#remote-buyer-phone').removeClass('control-group');
                $('#remote-buyer-email').removeClass('control-group');
                $('#transactionClosing_closing_buyerContact_phone').removeClass('required validate-for-row');
                $('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');
                //Buyer Agent's email not mandatory when representing a seller
                $("#transactionClosing_closing_buyersAgentContact_email").removeClass('required validate-for-row').closest('.control-group').removeClass('error');
                //Buyer Office's email not mandatory when representing a seller
                $("#transactionClosing_closing_buyersOfficeContact_email").removeClass('required validate-for-row').closest('.control-group').removeClass('error');
                {% else %}

                setTimeout(function() {
                    $('.lisa').each(function( index ) {
                        if ($( this ).find('input:first').val()){
                            $( this ).removeClass('error');
                            $( this ).addClass('success');
                        }else{
                            $( this ).removeClass('success');
                            $( this ).addClass('error');
                        }

                    });
                     quickFixFields();
                }, 500);
                {% endif %}
            }
            if ($('#transactionClosing_closing_represent').val() === 'Buyer' || $('#transactionClosing_closing_represent').val() === 'Tenant') {
                $('.sellerPhoneChange').removeClass('control-group');
                $('.sellerEmailChange').removeClass('control-group');
                $('#transactionClosing_closing_sellerContact_phone').removeClass('required validate-for-row');
                $('#transactionClosing_closing_sellerContact_email').removeClass('required validate-for-row');
                
            }
            if ($('#transactionClosing_closing_represent').val() === 'Landlord') {
                $('#remote-buyer-phone').removeClass('control-group');
                $('#remote-buyer-email').removeClass('control-group');
                $('#transactionClosing_closing_buyerContact_phone').removeClass('required validate-for-row');
                $('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');
            }
        });
        var contactsUrl = "{{ path('contact_json') }}?query=%QUERY";
        var usersRestPath = "{{ path('rest_user_getall')}}?query=%QUERY";
        var vendorsRestTitlePath = "{{ path('rest_user_getall')}}?type=8&query=%QUERY";
        var vendorsRestEscrowPath = "{{ path('rest_user_getall')}}?type=281&query=%QUERY";
        var vendorsRestInspectorPath = "{{ path('rest_user_getall')}}?type=13&query=%QUERY";
        var vendorsRestInsurancePath = "{{ path('rest_user_getall')}}?type=31&query=%QUERY";
        var vendorsRestLenderPath = "{{ path('rest_user_getall')}}?type=12&query=%QUERY";
        $(document).ready(function () {
            {% if app.user.role.level == 7 %}
            $('#transactionClosing_closing_buyersAgentContact_contactName').removeClass('hidden');
            $('.js-data-example-ajax').addClass('hidden');
            $('.select2').addClass('hidden');
            {% endif %}
            {% if closingId is null %}
            $('#transactionListing_listing_type').change(function () {

                var type = $('#transactionListing_listing_type').val();
                if (type === 'Lease') {
                    $("tr#contact_row_0 span.contact_type").text('Landlord');
                    $("tr#contact_row_3").hide();
                } else {
                    $("tr#contact_row_0 span.contact_type").text('Seller');
                    $("tr#contact_row_3").show();
                }
            });
            {% if app.user.role.level == 7 %}
            $('#transactionClosing_closing_buyersAgentContact_contactName').val("{{ app.user.firstname }} {{ app.user.lastname }}");
            $('#transactionClosing_closing_buyersAgentContact_phone').val("{{ app.user.primaryPhone.number }}");
            $('#transactionClosing_closing_buyersAgentContact_email').val("{{ app.user.primaryEmail.email }}");
            getContacts({{ app.user.id }});
            toggleBuyerRow(false);
            {% endif %}
            var companyName = '';
            var companyPhone = '';
            var companyEmail = '';
            var companyContactName = '';
            {% for business in app.user.businesses %}
            {% if business.id == app.session.get('current_business') %}
            companyName = "{{ business.name }}".replace(/&amp;/g, '&');
            {% if business.contact.phones.first %}
            companyPhone = "{{ business.contact.phones.first.number }}";
            {% endif %}
            {% if business.contact.emails.first %}
            companyEmail = "{{ business.contact.emails.first.email }}";
            {% endif %}
            {% if business.contactName %}
            companyContactName = "{{ business.contactName }}";
            {% endif %}
            {% endif %}
            {% endfor %}
            $('#transactionClosing_closing_buyersOfficeContact_contactName').val(companyContactName);
            $('#transactionClosing_closing_buyersOfficeContact_phone').val(companyPhone);
            $('#transactionClosing_closing_buyersOfficeContact_email').val(companyEmail);
            $('#transactionClosing_closing_buyersOfficeContact_company').val(companyName);
            $('#transactionClosing_closing_buyersAgentContact_company').val(companyName);
            {% endif %}
            {% if sellerContact.contactName is defined and sellerContact.contactName is not null %}
            $('#transactionClosing_closing_sellerContact_contactName').val("{{ sellerContact.contactName}}");
            {% endif %}
            {% if sellerContact.phone is defined and sellerContact.phone is not null %}
           // console.log("{{ sellerContact.phone}}");
            $('#transactionClosing_closing_sellerContact_phone').val("{{ sellerContact.phone}}");
            {% endif %}
            {% if sellerContact.email is defined and sellerContact.email is not null %}
			//console.log("{{ sellerContact.email}}");
            $('#transactionClosing_closing_sellerContact_email').val("{{ sellerContact.email}}");
            {% endif %}
            {% if sellerContact.company is defined and sellerContact.company is not null %}
            $('#transactionClosing_closing_sellerContact_company').val("{{ sellerContact.company}}");
            {% endif %}
            {% if listingAgentContact.contactName is defined and listingAgentContact.contactName is not null %}
            $('#transactionClosing_closing_listingAgentContact_contactName').val("{{ listingAgentContact.contactName}}");
            {% endif %}
            {% if listingAgentContact.phone is defined and listingAgentContact.phone is not null %}
            $('#transactionClosing_closing_listingAgentContact_phone').val("{{ listingAgentContact.phone}}");
            {% endif %}
            {% if listingAgentContact.email is defined and listingAgentContact.email is not null %}
            $('#transactionClosing_closing_listingAgentContact_email').val("{{ listingAgentContact.email}}");
            {% endif %}
            {% if listingAgentContact.company is defined and listingAgentContact.company is not null %}
            $('#transactionClosing_closing_listingAgentContact_company').val("{{ listingAgentContact.company}}");
            {% endif %}
            {% if listingOfficeContact.contactName is defined and listingOfficeContact.contactName is not null %}
            $('#transactionClosing_closing_listingOfficeContact_contactName').val("{{ listingOfficeContact.contactName}}");
            {% endif %}
            {% if listingOfficeContact.phone is defined and listingOfficeContact.phone is not null %}
            $('#transactionClosing_closing_listingOfficeContact_phone').val("{{ listingOfficeContact.phone}}");
            {% endif %}
            {% if listingOfficeContact.email is defined and listingOfficeContact.email is not null %}
            $('#transactionClosing_closing_listingOfficeContact_email').val("{{ listingOfficeContact.email}}");
            {% endif %}
            {% if listingOfficeContact.company is defined and listingOfficeContact.company is not null %}
            $('#transactionClosing_closing_listingOfficeContact_company').val("{{ listingOfficeContact.company }}");
            {% endif %}
            {% if titleCompanyContact.contactName is defined and titleCompanyContact.contactName is not null %}
            $('#transactionClosing_closing_titleCompanyContact_contactName').val("{{ titleCompanyContact.contactName}}");
            {% endif %}
            {% if titleCompanyContact.phone is defined and titleCompanyContact.phone is not null and titleCompanyContact.phone != '' %}
            $('#transactionClosing_closing_titleCompanyContact_phone').val("{{ titleCompanyContact.phone}}");
            {% endif %}
            {% if titleCompanyContact.email is defined and titleCompanyContact.email is not null and titleCompanyContact.email != '' %}
            $('#transactionClosing_closing_titleCompanyContact_email').val("{{ titleCompanyContact.email}}");
            {% endif %}
            {% if titleCompanyContact.company is defined and titleCompanyContact.company is not null %}
            $('#transactionClosing_closing_titleCompanyContact_company').val("{{ titleCompanyContact.company}}");
            {% endif %}
            {#$('#transactionClosing_closing_buyersOfficeContact_contactName').val(companyContactName);
            $('#transactionClosing_closing_buyersOfficeContact_phone').val(companyPhone);
            $('#transactionClosing_closing_buyersOfficeContact_email').val(companyEmail);
            $('#transactionClosing_closing_buyersOfficeContact_company').val(companyName);#}
            {% if app.user.businesses[0].id == 50 %}
            $('#transactionClosing_closing_moneyBox_paymentType').removeClass('required_field required');
            {% else %}
            $('#transactionClosing_closing_moneyBox_paymentType').on('change', function(){
                if ($(this).val() != '') {
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').addClass('success');
                } else {
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').addClass('error');
                    $('#transactionClosing_closing_moneyBox_paymentType').closest('.control-group').removeClass('success');
                }
            });
            {% endif %}
            // validation for Buyer contact
            if ($('#transactionClosing_closing_buyerContact_contactName').val() != '') {
                $('#transactionClosing_closing_buyerContact_contactName').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_buyerContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_buyerContact_contactName').closest('.control-group').removeClass('success');
            }
            {% if app.user.businesses[0].id != 50 %}
            if ($('#transactionClosing_closing_buyerContact_phone').val() != '') {
                $('#transactionClosing_closing_buyerContact_phone').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_buyerContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_buyerContact_phone').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_buyerContact_email').val() != '') {
                $('#transactionClosing_closing_buyerContact_email').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_buyerContact_email').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_buyerContact_email').closest('.control-group').removeClass('success');
            }
            {% endif %}
            // validation for Title Company contact
            if ($('#transactionClosing_closing_titleCompanyContact_contactName').val() != '') {
                $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').addClass('success');
                $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('error');
            } else {
                $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_titleCompanyContact_phone').val() != '') {
                $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').addClass('success');
                $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').removeClass('error');
            } else {
                $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').removeClass('success');
            }
            // validation for Buyer office contact
            if ($('#transactionClosing_closing_buyersOfficeContact_contactName').val() != '') {
                $('#transactionClosing_closing_buyersOfficeContact_contactName').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_buyersOfficeContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_buyersOfficeContact_contactName').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_buyersOfficeContact_phone').val() != '') {
                $('#transactionClosing_closing_buyersOfficeContact_phone').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_buyersOfficeContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_buyersOfficeContact_phone').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_buyersOfficeContact_email').val() != '') {
                $('#transactionClosing_closing_buyersOfficeContact_email').closest('.control-group').addClass('success');
            }
            // validation for Buyer Agent contact
            if ($('#transactionClosing_closing_buyersAgentContact_contactName').val() != '') {
                $('#transactionClosing_closing_buyersAgentContact_contactName').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_buyersAgentContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_buyersAgentContact_contactName').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_buyersAgentContact_phone').val() != '') {
                $('#transactionClosing_closing_buyersAgentContact_phone').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_buyersAgentContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_buyersAgentContact_phone').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_buyersAgentContact_email').val() != '') {
                $('#transactionClosing_closing_buyersAgentContact_email').closest('.control-group').addClass('success');
            }
            // validation for seller contact
            if ($('#transactionClosing_closing_sellerContact_contactName').val() != '') {
                $('#transactionClosing_closing_sellerContact_contactName').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_sellerContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_sellerContact_contactName').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_sellerContact_phone').val() != '') {
                $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_sellerContact_email').val() != '') {
                $('#transactionClosing_closing_sellerContact_email').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_sellerContact_email').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_sellerContact_email').closest('.control-group').removeClass('success');
            }
            // validation for Listing agent contact
            if ($('#transactionClosing_closing_listingAgentContact_contactName').val() != '') {
                $('#transactionClosing_closing_listingAgentContact_contactName').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_listingAgentContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_listingAgentContact_contactName').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_listingAgentContact_phone').val() != '') {
                $('#transactionClosing_closing_listingAgentContact_phone').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_listingAgentContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_listingAgentContact_phone').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_listingAgentContact_email').val() != '') {
                $('#transactionClosing_closing_listingAgentContact_email').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_listingAgentContact_email').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_listingAgentContact_email').closest('.control-group').removeClass('success');
            }
            // validation for Listing office contact
            if ($('#transactionClosing_closing_listingOfficeContact_contactName').val() != '') {
                $('#transactionClosing_closing_listingOfficeContact_contactName').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_listingOfficeContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_listingOfficeContact_contactName').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_listingOfficeContact_phone').val() != '') {
                $('#transactionClosing_closing_listingOfficeContact_phone').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_listingOfficeContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_listingOfficeContact_phone').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_listingOfficeContact_email').val() != '') {
                $('#transactionClosing_closing_listingOfficeContact_email').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_listingOfficeContact_email').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_listingOfficeContact_email').closest('.control-group').removeClass('success');
            }
            // validation for Listing office contact
            {% if mode is not null and mode == 'T' %}
            if ($('#transactionClosing_closing_titleCompanyContact_contactName').val() != '') {
                $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_titleCompanyContact_phone').val() != '') {
                $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_titleCompanyContact_email').val() != '') {
                $('#transactionClosing_closing_titleCompanyContact_email').closest('.control-group').addClass('success');
            } else {
                $('#transactionClosing_closing_titleCompanyContact_email').closest('.control-group').addClass('error');
                $('#transactionClosing_closing_titleCompanyContact_email').closest('.control-group').removeClass('success');
            }
            {% endif %}
            // closing date and contract date mandatory
            $('#transactionClosing_closing_closingContacts_0_title').prop('required', true);
            $('#transactionClosing_closing_closingContacts_0_time').prop('required', true);
            $('#transactionClosing_closing_closingContacts_1_title').prop('required', true);
            $('#transactionClosing_closing_closingContacts_1_time').prop('required', true);
            if ($('#transactionClosing_closing_closingContacts_0_title').val() != '') {
                $('#transactionClosing_closing_closingContacts_0_title').closest('.input-group').addClass('success');
            } else {
                $('#transactionClosing_closing_closingContacts_0_title').closest('.input-group').addClass('error');
                $('#transactionClosing_closing_closingContacts_0_title').closest('.input-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_closingContacts_0_time').val() != '') {
                $('#transactionClosing_closing_closingContacts_0_time').closest('.input-group').addClass('success');
            } else {
                $('#transactionClosing_closing_closingContacts_0_time').closest('.input-group').addClass('error');
                $('#transactionClosing_closing_closingContacts_0_time').closest('.input-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_closingContacts_1_title').val() != '') {
                $('#transactionClosing_closing_closingContacts_1_title').closest('.input-group').addClass('success');
            } else {
                $('#transactionClosing_closing_closingContacts_1_title').closest('.input-group').addClass('error');
                $('#transactionClosing_closing_closingContacts_1_title').closest('.input-group').removeClass('success');
            }
            if ($('#transactionClosing_closing_closingContacts_1_time').val() != '') {
                $('#transactionClosing_closing_closingContacts_1_time').closest('.input-group').addClass('success');
            } else {
                $('#transactionClosing_closing_closingContacts_1_time').closest('.input-group').addClass('error');
                $('#transactionClosing_closing_closingContacts_1_time').closest('.input-group').removeClass('success');
            }
            if ($('#transactionClosing_transactionProperty_property_type').val() === 'Vacant_Land') {
                $(".optional_year").addClass('hidden');
                $('#transactionClosing_transactionProperty_yearBuilt').prop('required', false);
                $('#transactionClosing_transactionProperty_yearBuilt').removeClass('required_field required');
            }else {
                $(".optional_year").removeClass('hidden');
                $('#transactionClosing_transactionProperty_yearBuilt').prop('required', true);
                $('#transactionClosing_transactionProperty_yearBuilt').addClass('required_field required');
            }
            if ($('#transactionClosing_closing_type').val() === 'Lease') {
                $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
                {% if (app.user.role.level > 5) and (closing.status|lower != 'sold_paid') %}
                $("#transactionClosing_closing_status option[value='Leased_Paid']").remove();
                {% endif %}
                $("#transactionClosing_closing_status option[value='Active_with_Contract']").remove();
            } else if ($('#transactionClosing_closing_type').val() !== 'Lease') {
                $("#transactionClosing_closing_status option[value='Leased_not_Paid']").remove();
                $("#transactionClosing_closing_status option[value='Leased_Paid']").remove();
            }
            $("#transactionClosing_closing_closingContacts_0_time").on('change', function () {
                var value = $(this).val();
                if (value !== '') {
                    $(this).closest('.input-group').addClass('success');
                    $(this).closest('.input-group').removeClass('error');
                } else {
                    $(this).closest('.input-group').addClass('error');
                    $(this).closest('.input-group').removeClass('success');
                }
            });
            $("#transactionClosing_closing_closingContacts_1_time").on('change', function () {
                var value = $(this).val();
                if (value !== '') {
                    $(this).closest('.input-group').addClass('success');
                    $(this).closest('.input-group').removeClass('error');
                } else {
                    $(this).closest('.input-group').addClass('error');
                    $(this).closest('.input-group').removeClass('success');
                }
            });
            // deposit alert box checked
            $('.show-deposit-alert').each(function () {
                if ($(this).is(":checked")) {
                    $(this).closest('tr').next().find('.alert_deposit').removeClass('hidden');
                } else {
                    $(this).closest('tr').next().find('.alert_deposit').addClass('hidden');
                }
            });
            // event alert box checked
            $('.show-event-alert').each(function () {
                if ($(this).is(":checked")) {
                    $(this).closest('tr').next().find('.alert_event').removeClass('hidden');
                } else {
                    $(this).closest('tr').next().find('.alert_event').addClass('hidden');
                }
            });
            $("body").on("change paste keyup", '.currency', function() {
                $(this).val(formatCurrency(this.value.replace(/[^0-9\.]+/g, "")));
            });
            function formatCurrency(number) {
                var n = number.split('').reverse().join("");
                var n2 = n.replace(/\d\d\d(?!$)/g, "$&,");

                var result = '$' + n2.split('').reverse().join('');

                if (number > 0) {
                    return result;
                } else {
                    return '';
                }
            }
            $('.btn-add').on('click', function (event) {
                var collectionHolder = $('#' + $(this).attr('data-target'));
                var prototype = collectionHolder.attr('data-prototype');
                var form = prototype.replace(/__name__/g, collectionHolder.children().length);
                collectionHolder.append(form);
                $(".form_meridian_datetime").datetimepicker({
                    autoclose: true,
                    isRTL: App.isRTL(),
                    format: "mm/dd/yyyy - hh:ii",
                    fontAwesome: true,
                    todayHighlight: true,
                    pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
                });
                $('.date-picker').datepicker({
                    format: "mm/dd/yyyy",
                    todayHighlight: true,
                    orientation: "right",
                    autoclose: true
                });
                return false;
            });
            $('.portlet-body').on('click', '.btn-remove', function (event) {
                var name = $(this).attr('data-related');
                $('*[data-content="' + name + '"]').remove();
                return false;
            });
            // deposit alert
            $('.portlet-body').on('click', '.show-deposit-alert', function () {
                if ($(this).is(":checked")) {
                    $(this).closest('tr').next().find('.alert_deposit').removeClass('hidden');
                } else {
                    $(this).closest('tr').next().find('.alert_deposit').addClass('hidden');
                }
            });
            $('.portlet-body').on('click', '.add-deposit-alert', function () {
                var collectionHolder = $(this).closest('tr').next().find('tbody');
                var row = $(this).closest('tr.deposit-row');
                var newRowHtml = row.data('prototype').replace(/__name__/g, collectionHolder.children().length);
                collectionHolder.append(newRowHtml);
                $(".form_meridian_datetime").datetimepicker({
                    autoclose: true,
                    isRTL: App.isRTL(),
                    format: "mm/dd/yyyy - hh:ii",
                    fontAwesome: true,
                    todayHighlight: true,
                    pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
                });
                $('.date-picker').datepicker({
                    format: "mm/dd/yyyy",
                    todayHighlight: true,
                    orientation: "right",
                    autoclose: true
                });
                return false;
            });
            // Event alert
            $('.add-event-alert').on('click', function () {
                $(this).closest('tr').next().find('.alert_event').removeClass('hidden');
                if (!$(this).closest('tr').next().find('.alert_event').hasClass('hidden')) {
                    var collectionHolder = $(this).closest('tr').next().find('tbody');
                    var row = $(this).closest('tr.event-row');
                    var newRowHtml = row.data('prototype').replace(/__name__/g, collectionHolder.children().length);
                    collectionHolder.append(newRowHtml);
                    $(".form_meridian_datetime").datetimepicker({
                        autoclose: true,
                        isRTL: App.isRTL(),
                        format: "mm/dd/yyyy - hh:ii",
                        fontAwesome: true,
                        todayHighlight: true,
                        pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
                    });
                    $('.date-picker').datepicker({
                        format: "mm/dd/yyyy",
                        todayHighlight: true,
                        orientation: "right",
                        autoclose: true
                    });
                }
                return false;
            });
            // money Box
            $("select#transactionClosing_closing_moneyBox_paymentType").change(function () {
                if ($(this).val().toLowerCase() === 'loan') {
                    $(".custom_box").show();
                    $('.loanOption').find('input').prop('required', true);
                    $('#transactionClosing_closing_closingContacts_5').removeClass('hidden');
                    $('#alert_transactionClosing_closing_closingContacts_5').removeClass('hidden');
                } else {
                    $(".custom_box").hide();
                    $('.loanOption').find('input').prop('required', false);
                    $('#transactionClosing_closing_closingContacts_5').addClass('hidden');
                    $('#alert_transactionClosing_closing_closingContacts_5').addClass('hidden');
                }
            });
            $("#transactionClosing_closing_moneyBox_referral_0").click(function () {
                if ($(this).val() == true) {
                    $(".custom_box_referral").show();
                    $(".referralQuestion").css("color", "green");
                }
            });
            $("#transactionClosing_closing_moneyBox_referral_1").click(function () {
                if ($(this).val() == false) {
                    $(".custom_box_referral").hide();
                    $(".referralQuestion").css("color", "green");
                }
            });
            $("#transactionClosing_closing_moneyBox_loan_0").click(function () {
                if ($(this).val() == true) {
                    $(".loanQuestion").css("color", "green");
                }
            });
            $("#transactionClosing_closing_moneyBox_loan_1").click(function () {
                if ($(this).val() == false) {
                    $(".loanQuestion").css("color", "green");
                }
            });
            $("#transactionClosing_closing_hoa_0").click(function () {
                if ($(this).val() == true) {
                    $(".hoaQuestion").css("color", "green");
                }
            });
            $("#transactionClosing_closing_hoa_1").click(function () {
                if ($(this).val() == false) {
                    $(".hoaQuestion").css("color", "green");
                }
            });
            $('.date-picker').datepicker({
                format: "mm/dd/yyyy",
                todayHighlight: true,
                orientation: "right",
                autoclose: true
            });
            $(".form_meridian_datetime").datetimepicker({
                autoclose: true,
                isRTL: App.isRTL(),
                format: "mm/dd/yyyy - hh:ii",
                fontAwesome: true,
                todayHighlight: true,
                pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
            });
            {% verbatim %}
            var bestPictures = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: usersRestPath,
                    wildcard: "%QUERY"
                }
            });
            bestPictures.initialize();
            {% endverbatim %}
            // Company Agents
            {% verbatim %}
            var agentBuyerJson;
            var agentSellerJson;
            var companyAgentsJson = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/company-agents?query=%QUERY",
                    wildcard: "%QUERY"
                }
            });
            companyAgentsJson.initialize();
            $('.buyerAgent .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'contactName',
                source: companyAgentsJson.ttAdapter(),
                templates: {
                    suggestion: Handlebars.compile([
                        '<div class="media">',
                        '<div class="pull-left">',
                        '<div class="media-object">',
                        '<img src="{{ profilepic }}" width="50" height="50"/>',
                        '</div>',
                        '</div>',
                        '<div class="media-body">',
                        '<h4 class="media-heading">{{ contactName }}</h4>',
                        '</div>',
                        '</div>',
                    ].join(''))
                }
            }).on('typeahead:selected', function (e, item) {
                $('.buyerAgent .typeahead').val(item.contactName);
                $('#buyerAgentId').val(item.id);
                $('#transactionClosing_closing_buyersAgentContact_email').val(item.email);
                $('#transactionClosing_closing_buyersAgentContact_phone').val(item.phone);
                // Agent Buyer
                {% endverbatim %}
                getContacts(item.id);
                getSellerContacts(item.id);
            });
            function getContacts(itemId) {
            }
            function getSellerContacts(itemId) {
                if (agentSellerJson instanceof  Bloodhound) {
                    $('.seller .typeahead').typeahead('destroy');
                }
                {% verbatim %}
                agentSellerJson = new Bloodhound({
                    datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                    queryTokenizer: Bloodhound.tokenizers.whitespace,
                    remote: {
                        url: "/agent-contacts?agent=" +itemId + "&query=%QUERY",
                        wildcard: "%QUERY"
                    }
                });
                agentSellerJson.initialize();
                $('.seller .typeahead').typeahead(null, {
                    name: 'best-pictures',
                    displayKey: 'contactName',
                    source: agentSellerJson.ttAdapter(),
                    templates: {
                        suggestion: Handlebars.compile([
                            '<div class="media">',
                            '<div class="pull-left">',
                            '<div class="media-object">',
                            '<img src="{{ profilepic }}" width="50" height="50"/>',
                            '</div>',
                            '</div>',
                            '<div class="media-body">',
                            '<h4 class="media-heading">{{contactName}}</h4>',
                            '</div>',
                            '</div>',
                        ].join(''))
                    }
                }).on('typeahead:selected', function (e, item) {
                    $('.seller .typeahead').val(item.contactName);
                    $('#transactionClosing_closing_sellerContact_email').val(item.email);
                    $('#transactionClosing_closing_sellerContact_phone').val(item.phone);
                    {% endverbatim %}
                });
            }
            // Title Company
            var titleCompanyJson = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: {% if (app.user.businesses[0].id == 50) %}"/vendors/114.json?query=%QUERY"{% else %}"/vendors/4.json?query=%QUERY"{% endif %},
                    wildcard: "%QUERY"
                }
            });
            {% verbatim %}
            titleCompanyJson.initialize();
            $('.titleCompany .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'contactName',
                source: titleCompanyJson.ttAdapter(),
                templates: {
                    suggestion: Handlebars.compile([
                        '<div class="media">',
                        '<div class="pull-left">',
                        '<div class="media-object">',
                        '<img src="{{ profilepic }}" width="50" height="50"/>',
                        '</div>',
                        '</div>',
                        '<div class="media-body">',
                        '<h4 class="media-heading">{{contactName}}</h4>',
                        '<p>{{businessName}}</p>',
                        '</div>',
                        '</div>',
                    ].join(''))
                }
            }).on('typeahead:selected', function (e, item) {
                $('.titleCompany .typeahead').val(item.contactName);
                $('#transactionClosing_closing_titleCompanyContact_email').val(item.email);
                $('#transactionClosing_closing_titleCompanyContact_phone').val(item.phone);
                $('#transactionClosing_closing_titleCompanyContact_company').val(item.businessName);
                {% endverbatim %}
            });
            // Escrow Company
            {% verbatim %}
            var escrowCompanyJson = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/vendors/107.json?query=%QUERY",
                    wildcard: "%QUERY"
                }
            });
            escrowCompanyJson.initialize();
            $('.escrowCompany .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'contactName',
                source: escrowCompanyJson.ttAdapter(),
                templates: {
                    suggestion: Handlebars.compile([
                        '<div class="media">',
                        '<div class="pull-left">',
                        '<div class="media-object">',
                        '<img src="{{ profilepic }}" width="50" height="50"/>',
                        '</div>',
                        '</div>',
                        '<div class="media-body">',
                        '<h4 class="media-heading">{{contactName}}</h4>',
                        '<p>{{businessName}}</p>',
                        '</div>',
                        '</div>',
                    ].join(''))
                }
            }).on('typeahead:selected', function (e, item) {
                $('.escrowCompany .typeahead').val(item.contactName);
                $('#transactionClosing_closing_escrowCompanyContact_email').val(item.email);
                $('#transactionClosing_closing_escrowCompanyContact_phone').val(item.phone);
                $('#transactionClosing_closing_escrowCompanyContact_company').val(item.businessName);
                {% endverbatim %}
            });
            // Home Inspector
            {% verbatim %}
            var bestPictures = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/vendors/8.json?query=%QUERY",
                    wildcard: "%QUERY"
                }
            });
            bestPictures.initialize
            $('.homeInspector .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'contactName',
                source: bestPictures.ttAdapter(),
                templates: {
                    suggestion: Handlebars.compile([
                        '<div class="media">',
                        '<div class="pull-left">',
                        '<div class="media-object">',
                        '<img src="{{ profilepic }}" width="50" height="50"/>',
                        '</div>',
                        '</div>',
                        '<div class="media-body">',
                        '<h4 class="media-heading">{{contactName}}</h4>',
                        '<p>{{businessName}}</p>',
                        '</div>',
                        '</div>',
                    ].join(''))
                }
            }).on('typeahead:selected', function (e, item) {
                $('.homeInspector .typeahead').val(item.contactName);
                $('#transactionClosing_closing_homeInspectorContact_email').val(item.email);
                $('#transactionClosing_closing_homeInspectorContact_phone').val(item.phone);
                $('#transactionClosing_closing_homeInspectorContact_company').val(item.businessName);
                {% endverbatim %}
            });
            // Home Insurance
            {% verbatim %}
            var bestPictures = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/vendors/20.json?query=%QUERY",
                    wildcard: "%QUERY"
                }
            });
            bestPictures.initialize();
            $('.homeInsurance .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'contactName',
                source: bestPictures.ttAdapter(),
                templates: {
                    suggestion: Handlebars.compile([
                        '<div class="media">',
                        '<div class="pull-left">',
                        '<div class="media-object">',
                        '<img src="{{ profilepic }}" width="50" height="50"/>',
                        '</div>',
                        '</div>',
                        '<div class="media-body">',
                        '<h4 class="media-heading">{{contactName}}</h4>',
                        '<p>{{ businessName }}</p>',
                        '</div>',
                        '</div>',
                    ].join(''))
                }
            }).on('typeahead:selected', function (e, item) {
                $('.homeInsurance .typeahead').val(item.contactName);
                $('#transactionClosing_closing_homeInsuranceContact_email').val(item.email);
                $('#transactionClosing_closing_homeInsuranceContact_phone').val(item.phone);
                $('#transactionClosing_closing_homeInsuranceContact_company').val(item.businessName);
                {% endverbatim %}
            });
            // Lender
            {% verbatim %}
            var bestPictures = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: "/vendors/7.json?query=%QUERY",
                    wildcard: "%QUERY"
                }
            });
            bestPictures.initialize();
            $('.lender .typeahead').typeahead(null, {
                name: 'best-pictures',
                displayKey: 'contactName',
                source: bestPictures.ttAdapter(),
                templates: {
                    suggestion: Handlebars.compile([
                        '<div class="media">',
                        '<div class="pull-left">',
                        '<div class="media-object">',
                        '<img src="{{ profilepic }}" width="50" height="50"/>',
                        '</div>',
                        '</div>',
                        '<div class="media-body">',
                        '<h4 class="media-heading">{{contactName}}</h4>',
                        '<p>{{businessName}}</p>',
                        '</div>',
                        '</div>',
                    ].join(''))
                }
            }).on('typeahead:selected', function (e, item) {
                $('.lender .typeahead').val(item.contactName);
                $('#transactionClosing_closing_lenderContact_email').val(item.email);
                $('#transactionClosing_closing_lenderContact_phone').val(item.phone);
                $('#transactionClosing_closing_lenderContact_company').val(item.businessName);
                {% endverbatim %}
            });
            $('.advanced_commission').click(function () {
                $('.regular_commission').removeClass('hidden');
                $('.advanced_commission').addClass('hidden');
                $('.advanced_1').removeClass('hidden');
                $('.advancedBox_1').html('&');
                $('.transactionClosing_closing_advancedCommissionBox').val(true);
            });
            $('.regular_commission').click(function () {
                $('.regular_commission').addClass('hidden');
                $('.advanced_commission').removeClass('hidden');
                $('.advanced_1').addClass('hidden');
                $('.advancedBox_1').html('');
                $('.transactionClosing_closing_advancedCommissionBox').val(false);
            });
            {% if (app.user.businesses[0].id in [50, 54]) %}
            $("#transactionClosing_closing_status option[value='Rejected_Offer']").remove();
            {% endif %}
            {% if (app.user.businesses[0].id not in [50, 54]) %}
            $('#transactionClosing_closing_status').on('change', function(){
                var cur_status = $(this).val();
                if(cur_status == 'Rejected_Offer') {
                    $("i.contact_status.titleCompany").hide();
                    if($('#transactionClosing_closing_type').val() != 'Lease') {
                        $('#transactionClosing_closing_titleCompanyContact_contactName').removeClass('required validate-for-row');
                        $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('error');
                        $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('success');
                        $('#transactionClosing_closing_titleCompanyContact_phone').removeClass('required validate-for-row');
                        $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').removeClass('error');
                        $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').removeClass('success');
                    }
                    $("i.contact_status.seller").hide();
                    $('#transactionClosing_closing_sellerContact_contactName').closest('.control-group').removeClass('error');
                    $('#transactionClosing_closing_sellerContact_contactName').closest('.control-group').removeClass('success');
                    $('#transactionClosing_closing_sellerContact_contactName').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_sellerContact_email').closest('.control-group').removeClass('error');
                    $('#transactionClosing_closing_sellerContact_email').closest('.control-group').removeClass('success');
                    $('#transactionClosing_closing_sellerContact_email').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').removeClass('error');
                    $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').removeClass('success');
                    $('#transactionClosing_closing_sellerContact_phone').removeClass('required validate-for-row');
                } else {
                    $("i.contact_status.titleCompany").show();
                    if($('#transactionClosing_closing_type').val() != 'Lease') {
                        $('#transactionClosing_closing_titleCompanyContact_contactName').addClass('required validate-for-row');
                        $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').addClass('error');
                        $('#transactionClosing_closing_titleCompanyContact_phone').addClass('required validate-for-row');
                        $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').addClass('error');
                    }
                    checkContactRow($('#transactionClosing_closing_titleCompanyContact_contactName').closest('tr'));
                    $("i.contact_status.seller").show();
                    $('#transactionClosing_closing_sellerContact_contactName').addClass('required validate-for-row');
                    $('#transactionClosing_closing_sellerContact_contactName').closest('.control-group').addClass('error');
                    $('#transactionClosing_closing_sellerContact_email').addClass('required validate-for-row');
                    $('#transactionClosing_closing_sellerContact_email').closest('.control-group').addClass('error');
                    $('#transactionClosing_closing_sellerContact_phone').addClass('required validate-for-row');
                    $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').addClass('error');
                    checkContactRow($('#transactionClosing_closing_sellerContact_phone').closest('tr'));
                }
            });
            {% endif %}

            {% if app.user.businesses[0].id == 50 %}
            $('.lisafield').focus(function() {
                $(this).css("background-color", "#fff");
                $( this ).css("border-color", "#468847");
            });
            {% endif %}
            $('#transactionClosing_closing_represent').change(function () {
                //alert(initPage)

                {% if app.user.businesses[0].id == 50 %}
					$('.lisafield').each(function( index ) {

						if ($( this ).val()){
							$( this ).css("background-color", "#fff");
							$( this ).css("border-color", "#468847");
						}else{
							$( this ).css("background-color", "rgb(250, 255, 189)");
							$( this ).css("border-color", "red");

						}
					});
                {% endif %}
                var i_represent = $(this).val();
                var property = $('#transactionClosing_transactionProperty_property_type').val();
                if (i_represent === 'Buyer' || i_represent === 'Buyer&Seller') {

                    if(initPage === false) {
                        $('#transactionClosing_closing_type').val('');
                    }

                    {% if app.user.businesses[0].id != 50 %}

					if(initPage === false) {
                        prefilBuyersOfficeRow();
                        prefilBuyersAgentRow();
                        toggleBuyerRow(false);
                        getContacts({{ agentId }});
                    }

                    $('.sellerPhoneChange').removeClass('control-group');
                    $('.sellerEmailChange').removeClass('control-group');
                    $('#transactionClosing_closing_sellerContact_phone').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_sellerContact_email').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_sellerContact_phone').removeAttr('required');
                    $('#transactionClosing_closing_sellerContact_email').removeAttr('required');
                    {% endif %}
                }
                {% if app.user.role.level <7 %}
                {% if mode in ['N', 'T'] %}
                if (i_represent === 'Seller' || i_represent === 'Landlord') {
                    $('#transactionClosing_closing_buyersAgentContact_contactName').removeClass('hidden');
                    $('.select2').addClass('hidden');
                }
                if (i_represent === 'Buyer&Seller' || i_represent === 'Landlord&Tenant') {
                    $('#transactionClosing_closing_buyersAgentContact_contactName').addClass('hidden');
                    $('.select2').removeClass('hidden');
                }
                {% else %}
                $('#transactionClosing_closing_buyersAgentContact_contactName').removeClass('hidden');
                $('.select2').addClass('hidden');
                {% endif %}
                {% endif %}
                if (i_represent === 'Seller' || i_represent === 'Landlord') {

                    {% if app.user.businesses[0].id == 50 %}

                    $('.lisa').each(function( index ) {
                        if ($( this ).find('input:first').val()){
                            $( this ).removeClass('error');
                            $( this ).addClass('success');
                        }else{
                            $( this ).removeClass('success');
                            $( this ).addClass('error');
                        }
                    });

                    $('.lisafield').each(function( index ) {
                        if ($(this).val()) {
                            $(this).css("background-color", "#fff");
                            $(this).css("border-color", "#468847");
                        } else {
                            $(this).css("background-color", "rgb(250, 255, 189)");
                            $(this).css("border-color", "red");

                        }
                    });
                    $("#transactionClosing_closing_buyerContact_email").css("background-color", "#fff");
                    $("#transactionClosing_closing_buyerContact_email").css("border-color", "");

                    if (i_represent === 'Seller'){
                        $("#transactionClosing_closing_buyersAgentContact_email").css("border-color","red");
                        $("#transactionClosing_closing_buyersOfficeContact_email").css("border-color","red");
                    }
                    
                    {% else %}


                    if (initPage === false) {
                        clearBuyersOfficeRow();
                        clearBuyersAgentRow();
                        toggleBuyerRow(true);
                    }
                    {% endif %}
                }
                if (i_represent === 'Landlord&Tenant'  ) {
                    {% if app.user.businesses[0].id != 50 %}
                    if(initPage === false) {
                        prefilBuyersOfficeRow();
                        prefilBuyersAgentRow();
                        toggleBuyerRow(false);
                        getContacts({{ agentId }});
                    }
                    {% else %}
                   {# if ($("#transactionClosing_closing_buyerContact_email").val()) {
                        $("#transactionClosing_closing_buyerContact_email").css("background-color", "#fff");
                        $("#transactionClosing_closing_buyerContact_email").css("border-color", "#468847");
                    } else {
                        $("#transactionClosing_closing_buyerContact_email").css("background-color", "rgb(250, 255, 189)");
                        $("#transactionClosing_closing_buyerContact_email").css("border-color", "red");
                    }#}
                    {% endif %}
                }
                // if agent represent both buyer and seller, fill the related fields
                if ( i_represent === 'Buyer&Seller' ) {

                    // /*used for  prefil  buyerand  agent Row */
                    prefilBuyersOfficeRow();
                    prefilBuyersAgentRow();


                    {% if app.user.businesses[0].id != 50 %}

                    if(initPage === false) {
                        prefilBuyersOfficeRow();
                        prefilBuyersAgentRow();
                        toggleBuyerRow(false);
                        getContacts({{ agentId }});
                    }
                    if($("#transactionClosing_closing_buyerContact_email").val())
                        $("#remote-buyer-email").addClass("success");
                    else
                        $("#remote-buyer-email").addClass("error");
                    
                    if($("#transactionClosing_closing_buyerContact_phone").val())
                        $("#remote-buyer-phone").addClass("success");
                    else
                        $("#remote-buyer-phone").addClass("error");
                    $("#transactionClosing_closing_buyerContact_email").removeClass("donotvalidate");
                    $("#transactionClosing_closing_buyerContact_phone").removeClass("donotvalidate");
                    {% else %}
                    {#$("#transactionClosing_closing_buyerContact_email").removeClass("donotvalidate"); //today code for issue 4377
                    if ($("#transactionClosing_closing_buyerContact_email").val()) {
                        $("#transactionClosing_closing_buyerContact_email").css("background-color", "#fff");
                        $("#transactionClosing_closing_buyerContact_email").css("border-color", "#468847");
                    } else {

                        $("#transactionClosing_closing_buyerContact_email").css("background-color", "rgb(250, 255, 189)");
                        $("#transactionClosing_closing_buyerContact_email").css("border-color", "red");
                        setTimeout(function() {
                            $("#transactionClosing_closing_buyerContact_email").addClass("required validate-for-row");
                        }, 500);

                    }#}
                    {% endif %}
                        $("#transactionClosing_closing_buyersAgentContact_email").css("background-color", "#fff");
                        $("#transactionClosing_closing_buyersOfficeContact_email").css("background-color", "#fff");
                }

                if (i_represent === 'Landlord') {
                    {% if app.user.businesses[0].id != 50 %}
                    if(initPage === false) {
                        clearBuyersOfficeRow();
                        clearBuyersAgentRow();
                        toggleBuyerRow(true);
                    }
                    {% endif %}
                }

                if (i_represent === 'Seller') {

					if(initPage === false) {
						clearBuyersOfficeRow();
						clearBuyersAgentRow();
						toggleBuyerRow(true);
					}

                }
               
                if (i_represent === 'Tenant' || i_represent === 'Landlord&Tenant' || i_represent === 'Landlord') {
                    // Change Buyer to Tenant
                    $("tr#contact_row_0 span.contact_type").text('Tenant');

                    // Change Buyer 2 to Tenant 2
                    $("tr#contact_row_0_00 span.contact_type").text('Tenant 2');
                    // Change Buyer's Agent to Tenant's
                    $("tr#contact_row_1 span.contact_type").text('Tenant\'s Agent');
                    // Change Buyer's office to Tenant's
                    $("tr#contact_row_2 span.contact_type").text('Tenant\'s Office');
                    // Change Seller to Landlord
                    $("tr#contact_row_4 span.contact_type").text('Landlord');
                    // Hide the title company row
                    $("tr#contact_row_7").hide();
                    $("tr#contact_row_8").hide();
                    $("tr#contact_row_9").hide();
                    $("tr#contact_row_10").hide();
                    $("tr#contact_row_11").hide();
                    $("tr#contact_row_15").hide(); //^@
                    $("#transactionClosing_closing_moneyBox_paymentType").parent().parent().hide();
                    $('#transactionClosing_closing_moneyBox_paymentType').removeClass('required_field required');
                    $('#transactionClosing_closing_titleCompanyContact_contactName').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_titleCompanyContact_phone').removeClass('required validate-for-row');
                    $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                    $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
                    if($("#transactionClosing_closing_status option[value='Leased_not_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_not_Paid').text('Leased not Paid'));
                    }
                    if($("#transactionClosing_closing_status option[value='Leased_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_Paid').text('Leased Paid'));
                    }
                } else {
                    {% if mode is not null and mode == 'T' %}
                    // Change Buyer to Tenant
                    $("tr#contact_row_0 span.contact_type").text('Tenant');
                    // Change Buyer's Agent to Tenant's
                    $("tr#contact_row_1 span.contact_type").text('Tenant\'s Agent');
                    // Change Buyer's office to Tenant's
                    $("tr#contact_row_2 span.contact_type").text('Tenant\'s Office');
                    // Change Seller to Landlord
                    $("tr#contact_row_4 span.contact_type").text('Landlord');
                    {% else %}
                    // Change Tenant to Buyer
                    $("tr#contact_row_0 span.contact_type").text('Buyer');

                    // Change Tenant 2 to Buyer 2
                    $("tr#contact_row_0_00 span.contact_type").text('Buyer 2');
                    // Change Tenant's Agent to Buyer's
                    $("tr#contact_row_1 span.contact_type").text('Buyer\'s Agent');
                    // Change Tenant's office to Buyer's
                    $("tr#contact_row_2 span.contact_type").text('Buyer\'s Office');
                    // Change Landlord to Seller
                    $("tr#contact_row_4 span.contact_type").text('Seller');
                    {% endif %}
                    $("tr#contact_row_7").show();
                    $("tr#contact_row_8").show();
                    $("tr#contact_row_9").show();
                    $("tr#contact_row_10").show();
                    $("tr#contact_row_11").show();
                    $("tr#contact_row_15").show();  // ^@
                    $("#transactionClosing_closing_moneyBox_paymentType").parent().parent().show();
                    {% if app.user.businesses[0].id != 50 %}
                        $('#transactionClosing_closing_titleCompanyContact_contactName').addClass('required validate-for-row');
                        $('#transactionClosing_closing_titleCompanyContact_phone').addClass('required validate-for-row');
                        $('#transactionClosing_closing_moneyBox_paymentType').addClass('required_field required');
                        
                        //code for DEATON ^@ (hidden validation on title email & title company)
                        $('#transactionClosing_closing_titleCompanyContact_email').removeClass('required validate-for-row');
                        $('#transactionClosing_closing_titleCompanyContact_email').addClass('donotvalidate');
                        
                        $('#transactionClosing_closing_titleCompanyContact_company').removeClass('required validate-for-row');
                        $('#transactionClosing_closing_titleCompanyContact_company').addClass('donotvalidate');
                        //code for DEATON ^@ (hidden validation on title email & title company)
                    {% endif %}
                }
                if (i_represent === 'Tenant') {
                    // Hide the Escrow Company row
                    $("tr#contact_row_8").hide();
                    // Hide the Home Inspector row
                    $("tr#contact_row_9").hide();
                    // Hide the Home Insurance row
                    $("tr#contact_row_10").hide();
                    // Hide the Lender row
                    $("tr#contact_row_11").hide();
                    {#$('#transactionClosing_closing_buyersOfficeContact_contactName').val("").closest('.control-group').removeClass('success').addClass('error');
                    $('#transactionClosing_closing_buyersOfficeContact_phone').val("").closest('.control-group').removeClass('success').addClass('error');
                    $('#transactionClosing_closing_buyersOfficeContact_email').val("").closest('.control-group').removeClass('success').addClass('error');
                    $('#transactionClosing_closing_buyersOfficeContact_company').val("").closest('.control-group').removeClass('success').addClass('error');
                    $('#transactionClosing_closing_buyersAgentContact_contactName').val("").closest('.control-group').removeClass('success').addClass('error');
                    $('#transactionClosing_closing_buyersAgentContact_phone').val("").closest('.control-group').removeClass('success').addClass('error');
                    $('#transactionClosing_closing_buyersAgentContact_email').val("").closest('.control-group').removeClass('success').addClass('error');
                    $('#transactionClosing_closing_buyersAgentContact_company').val("").closest('.control-group').removeClass('success').addClass('error');#}
                    $('#transactionClosing_closing_type').val('Lease');

                    $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                    $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
//                    $("#transactionClosing_closing_status option[value='Leased_not_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Leased_not_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_not_Paid').text('Leased not Paid'));
                    }
                    {% if (app.user.role.level <= 5) %}
//                    $("#transactionClosing_closing_status option[value='Leased_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Leased_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_Paid').text('Leased Paid'));
                    }
                    {% endif %}
                    $('.sellerEmailChange').removeClass('control-group');
                    $('.sellerPhoneChange').removeClass('control-group');
                    $('#transactionClosing_closing_buyerContact_phone').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_buyerContact_phone').addClass('required validate-for-row');
                    $('#transactionClosing_closing_buyerContact_email').addClass('required validate-for-row');
                    $(".custom_box_hoa").hide();
                    $('#transactionClosing_closing_titleCompanyContact_contactName').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_titleCompanyContact_phone').removeClass('required validate-for-row');
                          //^@
                $("#transactionClosing_closing_sellerContact_phone").removeClass("required validate-for-row");
                $("#transactionClosing_closing_sellerContact_phone").addClass("donotvalidate");
                $("#transactionClosing_closing_sellerContact_email").removeClass("required validate-for-row");
                $("#transactionClosing_closing_sellerContact_email").addClass("donotvalidate");
                //^@
                    
                } else if ((property === 'Single_Family_Home' || property === 'Condo/Co-op' || property === 'Multi-Family' || property === 'Manufactured_Home') && (i_represent === 'Buyer' || i_represent === 'Buyer&Seller')) {
                    $(".custom_box_hoa").show();
                    $('.hoaOption').find('input').prop('required', true);
                    $('#remote-buyer-phone').removeClass('control-group');
                    $('#transactionClosing_closing_buyerContact_phone').removeClass('required validate-for-row');
                    {% if app.user.businesses[0].id != 54 %}
                    $('#remote-buyer-email').removeClass('control-group');
                    $('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');
                    {% endif %}
                    $('#remote-buyer-phone').addClass('control-group');
                    $('#remote-buyer-email').addClass('control-group');
                    $('#transactionClosing_closing_buyerContact_phone').addClass('required validate-for-row');
                    $('#transactionClosing_closing_buyersAgentContact_email').addClass('required validate-for-row');
                    $('#transactionClosing_closing_buyersOfficeContact_email').addClass('required validate-for-row');
                    <!--$('#transactionClosing_closing_type').find("option[value='{{ paymentType }}']").attr('selected', 'selected');-->
                    $("#transactionClosing_closing_status option[value='Leased_not_Paid']").remove();
                    $("#transactionClosing_closing_status option[value='Leased_Paid']").remove();
                    {% if (app.user.role.level > 5 and app.user.businesses[0].id == 54) %}
                    $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                    {% else %}
                    {% if (app.user.role.level <= 5) %}
//                            $("#transactionClosing_closing_status option[value='Sold_not_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Sold_not_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_not_Paid').text('Sold not Paid'));
                    }
                    {% endif %}
                    {% endif %}
                    {% if (app.user.role.level <= 5) %}
//                        $("#transactionClosing_closing_status option[value='Sold_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Sold_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_Paid').text('Sold Paid'));
                    }
                    {% else %}
                    {% if (app.user.role.level > 5) and (closing.status|lower != 'sold_paid') %}
                    $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
                    {% endif %}
                    {% endif %}
                } else if ((i_represent === 'Seller') || (i_represent === 'Landlord')) {
                    $('#remote-buyer-phone').removeClass('control-group');
                    $('#remote-buyer-email').addClass('control-group');//^@  remove so as to validate email
		    {% if app.user.businesses[0].id != 50 %}
                    if(i_represent === 'Seller')
                        $('#remote-buyer-email').removeClass('control-group');// ^%
                    {% endif %}
                    $('#transactionClosing_closing_buyerContact_email').addClass('donotvalidate');
                    $('#transactionClosing_closing_buyerContact_phone').addClass('donotvalidate');
                    $('#transactionClosing_closing_buyerContact_phone').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');

                    //Buyer Agent's email not mandatory when representing a seller
                    $("#transactionClosing_closing_buyersAgentContact_email").removeClass('required validate-for-row').closest('.control-group').removeClass('error');
                    //Buyer Office's email not mandatory when representing a seller
                    $("#transactionClosing_closing_buyersOfficeContact_email").removeClass('required validate-for-row').closest('.control-group').removeClass('error');
                    if (i_represent === 'Seller') {
                        <!--$('#transactionClosing_closing_type').find("option[value='{{ paymentType }}']").attr('selected', 'selected');-->
                        $("#transactionClosing_closing_status option[value='Leased_not_Paid']").remove();
                        $("#transactionClosing_closing_status option[value='Leased_Paid']").remove();
                        {% if (app.user.role.level > 5 and app.user.businesses[0].id == 54) %}
                        $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                        {% else %}
                        {% if (app.user.role.level <= 5) %}
//                                $("#transactionClosing_closing_status option[value='Sold_not_Paid']").show();
                        if($("#transactionClosing_closing_status option[value='Sold_not_Paid']").length == 0) {
                            $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_not_Paid').text('Sold not Paid'));
                        }
                        {% endif %}
                        {% endif %}
                        {% if (app.user.role.level <= 5) %}
//                            $("#transactionClosing_closing_status option[value='Sold_Paid']").show();
                        if($("#transactionClosing_closing_status option[value='Sold_Paid']").length == 0) {
                            $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_Paid').text('Sold Paid'));
                        }
                        {% else %}
                        {% if (app.user.role.level > 5) and (closing.status|lower != 'sold_paid') %}
                        $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
                        {% endif %}
                        {% endif %}
                    }
                } else if (i_represent === 'Tenant' || i_represent === 'Landlord&Tenant' || i_represent === 'Landlord') {
                    $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                    $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
                    if($("#transactionClosing_closing_status option[value='Leased_not_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_not_Paid').text('Leased not Paid'));
                    }
                    if($("#transactionClosing_closing_status option[value='Leased_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_Paid').text('Leased Paid'));
                    }
                } else {
                    <!--$('#transactionClosing_closing_type').find("option[value='{{ paymentType }}']").attr('selected', 'selected');-->
                    $("#transactionClosing_closing_status option[value='Leased_not_Paid']").remove();
                    $("#transactionClosing_closing_status option[value='Leased_Paid']").remove();
                    {% if (app.user.role.level > 5 and app.user.businesses[0].id == 54) %}
                    $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                    {% else %}
                    {% if (app.user.role.level <= 5) %}
//                            $("#transactionClosing_closing_status option[value='Sold_not_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Sold_not_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_not_Paid').text('Sold not Paid'));
                    }
                    {% endif %}
                    {% endif %}
                    {% if (app.user.role.level <= 5) %}
//                        $("#transactionClosing_closing_status option[value='Sold_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Sold_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_Paid').text('Sold Paid'));
                    }
                    {% else %}
                    {% if (app.user.role.level > 5) and (closing.status|lower != 'sold_paid') %}
                    $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
                    {% endif %}
                    {% endif %}
                    $(".custom_box_hoa").hide();
                    $('.hoaOption').find('input').prop('required', false);
                    $('#remote-buyer-phone').removeClass('control-group');
                    $('#remote-buyer-email').removeClass('control-group');
                    $('#transactionClosing_closing_buyerContact_phone').removeClass('required validate-for-row');
                    $('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');
                    $('#remote-buyer-phone').addClass('control-group');
                    $('#remote-buyer-email').addClass('control-group');
                    $('#transactionClosing_closing_buyerContact_phone').addClass('required validate-for-row');
                    $('#transactionClosing_closing_buyerContact_email').addClass('required validate-for-row');
                }
                if(initPage === true) {
                    initPage = false;
                }
//                if (i_represent == 'Buyer' || i_represent == 'Buyer&Seller') {
//                    $('#transactionClosing_closing_type').find('option:first').attr('selected', 'selected');
//                }
                 //^@ code for issue 8 
                 {% if app.user.businesses[0].id != 50 %}
                 if(i_represent == 'Buyer' || i_represent == 'Tenant'){
                     if($("#transactionClosing_closing_buyerContact_email").val()){
                        $("#transactionClosing_closing_buyerContact_email").css("border-color","#468847");
                        $("#transactionClosing_closing_buyerContact_email").css("background","#fff");
                     }
                     else{
                       $("#transactionClosing_closing_buyerContact_email").css("border-color","red");
                       $("#transactionClosing_closing_buyerContact_email").css("background","rgb(250, 255, 189)");  
                     }
                 }
                 {% endif %}
                //^@ end of code for issue 8 
                
                //code to resolve issue #4371 #4380 for new creation of Tenant file
                if(i_represent == 'Landlord'){
                    $("#transactionClosing_closing_buyerContact_phone").css("border-color","#c2cad8");
                    $("#transactionClosing_closing_buyerContact_phone").css("background","#fff");
                    {% if app.user.businesses[0].id != 50 %}
                        $("#transactionClosing_closing_buyerContact_email").closest(".control-group").removeClass("control-group");
                    {% else %}
                        $("#remote-buyer-phone").addClass("control-group");
                        $("#transactionClosing_closing_buyerContact_phone").css("border-color","red");
                    {% endif %}
                    $("#transactionClosing_closing_sellerContact_email").removeClass("donotvalidate");
                    $("#transactionClosing_closing_sellerContact_phone").removeClass("donotvalidate");
                    $("#transactionClosing_closing_sellerContact_phone").addClass("required validate-for-row");
                    $("#transactionClosing_closing_sellerContact_email").addClass("required validate-for-row");
                    $("#transactionClosing_closing_buyersOfficeContact_email").addClass("required validate-for-row");
                    $("#transactionClosing_closing_buyersAgentContact_email").addClass("required validate-for-row");
                    
                    if($("#transactionClosing_closing_buyersAgentContact_email").val()==''){
                        $("#transactionClosing_closing_buyersAgentContact_email").closest(".control-group").addClass("error");
                        $("#transactionClosing_closing_buyersAgentContact_email").css("border-color","red");
                        $("#transactionClosing_closing_buyersAgentContact_email").css("background-color","rgb(250, 255, 189)");
                    }
                    else{
                        $("#transactionClosing_closing_buyersAgentContact_email").closest(".control-group").addClass("success");
                        $("#transactionClosing_closing_buyersAgentContact_email").css("border-color","green");
                        $("#transactionClosing_closing_buyersAgentContact_email").css("background-color","#fff");
                    }
                    
                    if($("#transactionClosing_closing_buyersOfficeContact_email").val()==""){
                        $("#transactionClosing_closing_buyersOfficeContact_email").closest(".control-group").addClass("error");
                        $("#transactionClosing_closing_buyersOfficeContact_email").css("border-color","red");
                        $("#transactionClosing_closing_buyersOfficeContact_email").css("background-color","rgb(250, 255, 189)");
                    }
                    else{
                        $("#transactionClosing_closing_buyersOfficeContact_email").closest(".control-group").addClass("success");
                        $("#transactionClosing_closing_buyersOfficeContact_email").css("border-color","green");
                        $("#transactionClosing_closing_buyersOfficeContact_email").css("background-color","#fff");
                    }
                }
                
                if(i_represent == 'Landlord&Tenant'){
                    $("#remote-buyer-email").addClass("control-group");
                    $("#remote-buyer-phone").addClass("control-group");
                     {% if app.user.businesses[0].id != 50 %}
                    $("#transactionClosing_closing_buyerContact_email").removeClass("donotvalidate");
                    $("#transactionClosing_closing_buyerContact_email").addClass("required validate-for-row");
                    $("#transactionClosing_closing_buyerContact_phone").removeClass("donotvalidate");
                    $("#transactionClosing_closing_buyerContact_phone").addClass("required validate-for-row");
                    if($("#transactionClosing_closing_buyerContact_email").val()=='')
                        $("#remote-buyer-email").addClass("error");
                    else
                        $("#remote-buyer-email").addClass("success");
                    
                    if($("#transactionClosing_closing_buyerContact_phone").val()=='')
                        $("#remote-buyer-phone").addClass("error");
                    else
                        $("#remote-buyer-phone").addClass("success");
                     {% endif %}
                    $("#transactionClosing_closing_sellerContact_phone").removeClass("donotvalidate");
                    $("#transactionClosing_closing_sellerContact_phone").addClass("required validate-for-row");
                    $("#transactionClosing_closing_sellerContact_email").removeClass("donotvalidate");
                    $("#transactionClosing_closing_sellerContact_email").addClass("required validate-for-row");
                    {% if app.user.businesses[0].id != 50 %}
                        $("#transactionClosing_closing_buyerContact_phone").css("border-color","red");
                    {% endif %}
                    $("#transactionClosing_closing_buyerContact2_contactName").removeClass("required validate-for-row");
                    $("#transactionClosing_closing_buyerContact2_address_street").removeClass("required validate-for-row");
                    $("#transactionClosing_closing_buyerContact2_contactName").addClass("donotvalidate");
                    $("#transactionClosing_closing_buyerContact2_address_street").addClass("donotvalidate");
                }
                if (i_represent === 'Buyer'){
                    $("#transactionClosing_closing_sellerContact_phone").addClass("donotvalidate");
                    $("#transactionClosing_closing_sellerContact_email").addClass("donotvalidate");
                }
                
                //end of code to resolve issue #4371 #4380 for new creation of Tenant file
                
                {#if (i_represent === 'Buyer'){
                    {% if app.user.businesses[0].id == 50 %}
                        $("#transactionClosing_closing_buyerContact_address_zip").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_titleCompanyContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerattorneyCompanyContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_phone").addClass("required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_city").addClass("required validate-for-row");
                        
                    {% endif %}
                }#}
                
                {#if (i_represent === 'Tenant'){
                    {% if app.user.businesses[0].id == 50 %}
                        $("#transactionClosing_closing_buyerContact_address_zip").addClass("required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_city").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingAgentContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_company").addClass("required validate-for-row");
                        $("#transactionClosing_closing_listingOfficeContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_phone").removeClass("donotvalidate");
                        $("#transactionClosing_closing_sellerContact_phone").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_email").removeClass("donotvalidate");
                        $(".sellerPhoneChange").addClass("control-group");
                        $(".sellerEmailChange").addClass("control-group");
                        $("#transactionClosing_closing_sellerContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_totalCommissions_0_value").addClass("required validate-for-row");
                        $("#transactionClosing_closing_buyerAgentCommissions_0_value").addClass("required validate-for-row");
                    {% endif %}
                }#}
                $("#trans_contacts_wrapper").find('input') .each(function() {
                if($(this).closest('.control-group').hasClass("success") || $(this).closest('.control-group').hasClass("error")){
                        if($(this).hasClass("tt-hint"))
                            $(this).removeClass("required");
                        else{
                            $(this).addClass("required");
                            $(this).removeClass("donotvalidate");
                        }
                    }
                });
                $('#trans_contacts_wrapper').find('input').on('input',function(e){
                    if($(this).closest('.control-group').hasClass("success")){
                        $(this).closest(".success").addClass("control-group");
                        $(this).css("border-color","red");
                       // $(this).css("background-color","rgb(250, 255, 189)");
                    }
                    if($(this).closest('.control-group').hasClass("error")){
                       $(this).closest(".error").addClass("control-group");
                       $(this).css("border-color","green");
                       $(this).css("background-color","#fff");
                    }
                    {% if app.user.businesses[0].id == 50 %}
                    if($(this).attr("id")=="transactionClosing_closing_buyersAgentContact_email"|| $(this).attr("id")=="transactionClosing_closing_buyersOfficeContact_email" || $(this).attr("id")=="transactionClosing_closing_listingAgentContact_email" || $(this).attr("id")=="transactionClosing_closing_listingOfficeContact_email"){
                        if ($("#transactionClosing_closing_buyersAgentContact_email").val()) {
                            $("#transactionClosing_closing_buyersAgentContact_email").css("background-color", "#fff");
                            $("#transactionClosing_closing_buyersAgentContact_email").css("border-color", "#468847");
                        } 
                        else {
                            $("#transactionClosing_closing_buyersAgentContact_email").css("background-color", "rgb(250, 255, 189)");
                            $("#transactionClosing_closing_buyersAgentContact_email").css("border-color", "red");
                        }
                        
                        if ($("#transactionClosing_closing_buyersOfficeContact_email").val()) {
                            $("#transactionClosing_closing_buyersOfficeContact_email").css("background-color", "#fff");
                            $("#transactionClosing_closing_buyersOfficeContact_email").css("border-color", "#468847");
                        } 
                        else {
                            $("#transactionClosing_closing_buyersOfficeContact_email").css("background-color", "rgb(250, 255, 189)");
                            $("#transactionClosing_closing_buyersOfficeContact_email").css("border-color", "red");
                        }
                        
                        if ($("#transactionClosing_closing_listingAgentContact_email").val()) {
                            $("#transactionClosing_closing_listingAgentContact_email").css("background-color", "#fff");
                            $("#transactionClosing_closing_listingAgentContact_email").css("border-color", "#468847");
                        } 
                        else {
                            $("#transactionClosing_closing_listingAgentContact_email").css("background-color", "rgb(250, 255, 189)");
                            $("#transactionClosing_closing_listingAgentContact_email").css("border-color", "red");
                        }
                        
                        if ($("#transactionClosing_closing_listingOfficeContact_email").val()) {
                            $("#transactionClosing_closing_listingOfficeContact_email").css("background-color", "#fff");
                            $("#transactionClosing_closing_listingOfficeContact_email").css("border-color", "#468847");
                        } 
                        else {
                            $("#transactionClosing_closing_listingOfficeContact_email").css("background-color", "rgb(250, 255, 189)");
                            $("#transactionClosing_closing_listingOfficeContact_email").css("border-color", "red");
                        }
                        
                       {# if ($("#transactionClosing_closing_sellerContact_email").val()) {
                            $("#transactionClosing_closing_sellerContact_email").css("background-color", "#fff");
                            $("#transactionClosing_closing_sellerContact_email").css("border-color", "#468847");
                        } 
                        else {
                            $("#transactionClosing_closing_sellerContact_email").css("background-color", "rgb(250, 255, 189)");
                            $("#transactionClosing_closing_sellerContact_email").css("border-color", "red");
                        }#}
                    }
                    {% endif %}
                });
                
                ////fix for issue #4424
                if (i_represent === 'Seller'){
                    
                        $("#transactionClosing_closing_buyersAgentContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_buyersOfficeContact_email").addClass("required validate-for-row");
                        if($("#transactionClosing_closing_buyersAgentContact_email").val()==''){
                            $("#transactionClosing_closing_buyersAgentContact_email").closest(".control-group").addClass("error");
                        }
                        else{
                            $("#transactionClosing_closing_buyersAgentContact_email").closest(".control-group").addClass("success");
                        }
                        
                        if($("#transactionClosing_closing_buyersOfficeContact_email").val()==''){
                            $("#transactionClosing_closing_buyersOfficeContact_email").closest(".control-group").addClass("error");
                        }
                        else{
                            $("#transactionClosing_closing_buyersOfficeContact_email").closest(".control-group").addClass("success");
                        }
                        
                        if($("#transactionClosing_closing_buyersAgentContact_email").closest(".control-group").hasClass("error")){
                            $("#transactionClosing_closing_buyersAgentContact_email").css("background-color","rgb(250, 255, 189)");
                            $("#transactionClosing_closing_buyersAgentContact_email").css("border-color","red");
                        }
                        
                        if($("#transactionClosing_closing_buyersOfficeContact_email").closest(".control-group").hasClass("error")){
                            $("#transactionClosing_closing_buyersOfficeContact_email").css("background-color","rgb(250, 255, 189)");
                            $("#transactionClosing_closing_buyersOfficeContact_email").css("border-color","red");
                        }
                      
                  
                }
                
                //fix for issue #4350
                if (i_represent === 'Tenant'){
                    {% if app.user.businesses[0].id == 50 %}
                        $("#transactionClosing_closing_sellerContact_email").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_phone").addClass("required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_email").removeClass("donotvalidate");
                        $("#transactionClosing_closing_sellerContact_phone").removeClass("donotvalidate");
                        if($("#transactionClosing_closing_sellerContact_email").val()==''){
                            $("#transactionClosing_closing_sellerContact_email").css("background-color","rgb(250, 255, 189)");
                            $("#transactionClosing_closing_sellerContact_email").css("border-color","red");
                        }
                        else{
                            $("#transactionClosing_closing_sellerContact_email").css("background-color","#fff");
                            $("#transactionClosing_closing_sellerContact_email").css("border-color","green");
                        }
                        if($("#transactionClosing_closing_sellerContact_phone").val()==''){
                            $("#transactionClosing_closing_sellerContact_phone").css("background-color","rgb(250, 255, 189)");
                            $("#transactionClosing_closing_sellerContact_phone").css("border-color","red");
                        }
                        else{
                            $("#transactionClosing_closing_sellerContact_phone").css("background-color","#fff");
                            $("#transactionClosing_closing_sellerContact_phone").css("border-color","green");
                        }
                    {% endif %}
                }
                
                if($("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("success") || $("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("error")){
                   $("#transactionClosing_closing_buyerAgentCommissions_0_value").addClass("required"); 
                }
                
                if($("#transactionClosing_closing_agentCommissions_0_value").closest('.control-group').hasClass("success") || $("#transactionClosing_closing_agentCommissions_0_value").closest('.control-group').hasClass("error")){
                    $("#transactionClosing_closing_agentCommissions_0_value").addClass("required");
                }
                
                if($("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("success") || $("#transactionClosing_closing_totalCommissions_0_value").closest('.control-group').hasClass("error")){
                    $("#transactionClosing_closing_totalCommissions_0_value").addClass("required");
                }
                
                if (i_represent === 'Tenant' || i_represent === 'Buyer' ||i_represent === 'Seller' ||i_represent === 'Buyer&Seller'){
                    //console.log("!@");
                    {% if app.user.businesses[0].id == 50 %}
                        $("#transactionClosing_closing_buyerContact_phone").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_email").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_phone").addClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_email").addClass("donotvalidate");
                        $("#remote-buyer-phone").removeClass("lisa error");
                        $("#remote-buyer-email").removeClass("lisa error");
                        noValidation('transactionClosing_closing_buyerContact_phone');
                        noValidation('transactionClosing_closing_buyerContact_email');
                        
                        $("#transactionClosing_closing_sellerContact_phone").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_email").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_phone").addClass("donotvalidate");
                        $("#transactionClosing_closing_sellerContact_email").addClass("donotvalidate");
                        $(".sellerPhoneChange").removeClass("lisa error");
                        $(".sellerEmailChange").removeClass("lisa error");
                        noValidation('transactionClosing_closing_sellerContact_phone');
                        noValidation('transactionClosing_closing_sellerContact_email');
                    {% endif %}
                }
                {% if app.user.businesses[0].id == 50 %}
                   // console.log("!@");
                    if(i_represent==='Seller' || i_represent==='Landlord'){
                        $("#transactionClosing_closing_buyerContact_address_street").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_street").addClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_street").closest('.control-group').removeClass("lisa error");
                        noValidation('transactionClosing_closing_buyerContact_address_street');
                        
                        $("#transactionClosing_closing_buyerContact_address_city").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_city").addClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_city").closest('.control-group').removeClass("lisa error");
                        noValidation('transactionClosing_closing_buyerContact_address_city');
                        
                        $("#transactionClosing_closing_buyerContact_address_state").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_state").addClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_state").closest('.control-group').removeClass("lisa error");
                        noValidation('transactionClosing_closing_buyerContact_address_state');
                        
                        $("#transactionClosing_closing_buyerContact_address_zip").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_zip").addClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_zip").closest('.control-group').removeClass("lisa error");
                        noValidation('transactionClosing_closing_buyerContact_address_zip');
                    }
                    
                    if(i_represent==='Buyer&Seller' || i_represent==='Landlord&Tenant'){
                        $("#transactionClosing_closing_buyerContact_address_street").addClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_street").removeClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_street").closest('.control-group').addClass("lisa error");
                        errorValidation('transactionClosing_closing_buyerContact_address_street');
                        
                        $("#transactionClosing_closing_buyerContact_address_city").addClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_city").removeClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_city").closest('.control-group').removeClass("lisa error");
                        errorValidation('transactionClosing_closing_buyerContact_address_city');
                        
                        $("#transactionClosing_closing_buyerContact_address_state").addClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_state").removeClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_state").closest('.control-group').addClass("lisa error");
                        errorValidation('transactionClosing_closing_buyerContact_address_state');
                        
                        $("#transactionClosing_closing_buyerContact_address_zip").addClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_address_zip").removeClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_address_zip").closest('.control-group').addClass("lisa error");
                        errorValidation('transactionClosing_closing_buyerContact_address_zip');
                    }
                    
                    if( i_represent==='Landlord' ||  i_represent==='Landlord&Tenant'){
                        
                        $("#transactionClosing_closing_buyerContact_phone").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_email").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_buyerContact_phone").addClass("donotvalidate");
                        $("#transactionClosing_closing_buyerContact_email").addClass("donotvalidate");
                        $("#remote-buyer-phone").removeClass("lisa error");
                        $("#remote-buyer-email").removeClass("lisa error");
                        noValidation('transactionClosing_closing_buyerContact_phone');
                        noValidation('transactionClosing_closing_buyerContact_email');
                        
                        
                        $("#transactionClosing_closing_sellerContact_phone").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_email").removeClass("lisafield required validate-for-row");
                        $("#transactionClosing_closing_sellerContact_phone").addClass("donotvalidate");
                        $("#transactionClosing_closing_sellerContact_email").addClass("donotvalidate");
                        $(".sellerPhoneChange").removeClass("lisa error");
                        $(".sellerEmailChange").removeClass("lisa error");
                        noValidation('transactionClosing_closing_sellerContact_phone');
                        noValidation('transactionClosing_closing_sellerContact_email');
                    }
                {% endif %}
                
            });
            $('#transactionClosing_closing_type').change(function () {
                var type = $(this).val();
                var i_represent = $('#transactionClosing_closing_represent').val();
                if (type === 'Lease') {
                    $('#transactionClosing_closing_represent').val('Tenant');
                    $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                    $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
//                    $("#transactionClosing_closing_status option[value='Leased_not_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Leased_not_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_not_Paid').text('Leased not Paid'));
                    }
                    {% if (app.user.role.level <= 5) %}
                    if($("#transactionClosing_closing_status option[value='Leased_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Leased_Paid').text('Leased Paid'));
                    }
//                        $("#transactionClosing_closing_status option[value='Leased_Paid']").show();
                    {% endif %}
                    $('#transactionClosing_closing_represent').trigger("change");
                } else if (type !== 'Lease' && i_represent === 'Tenant') {
                    $('#transactionClosing_closing_represent').val($('#transactionClosing_closing_represent option:first').val());
                    $("#transactionClosing_closing_status option[value='Leased_not_Paid']").remove();
                    $("#transactionClosing_closing_status option[value='Leased_Paid']").remove();
                    {% if (app.user.role.level > 5 and app.user.businesses[0].id == 54) %}
                    $("#transactionClosing_closing_status option[value='Sold_not_Paid']").remove();
                    {% else %}
                    {% if (app.user.role.level <= 5) %}
//                            $("#transactionClosing_closing_status option[value='Sold_not_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Sold_not_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_not_Paid').text('Sold not Paid'));
                    }
                    {% endif %}
                    {% endif %}
                    {% if (app.user.role.level <= 5) %}
//                        $("#transactionClosing_closing_status option[value='Sold_Paid']").show();
                    if($("#transactionClosing_closing_status option[value='Sold_Paid']").length == 0) {
                        $('#transactionClosing_closing_status').append($("<option></option>").attr("value", 'Sold_Paid').text('Sold Paid'));
                    }
                    {% else %}
                    {% if (app.user.role.level > 5) and (closing.status|lower != 'sold_paid') %}
                    $("#transactionClosing_closing_status option[value='Sold_Paid']").remove();
                    {% endif %}
                    {% endif %}
                }
            });
            $('#transactionClosing_transactionProperty_property_type').change(function () {
                var property = $(this).val();
                var i_represent = $('#transactionClosing_closing_represent').val();
                if ((i_represent === 'Buyer' || i_represent === 'Buyer&Seller') && (property === 'Single_Family_Home' || property === 'Condo/Co-op' || property === 'Multi-Family' || property === 'Manufactured_Home')) {
                    $(".custom_box_hoa").show();
                    $('.hoaOption').find('input').prop('required', true);
                    $('.custom_box_hoa').closest('.control-group').addClass('error');
                    $(".optional_year").removeClass('hidden');
                    $('#transactionClosing_transactionProperty_yearBuilt').prop('required', true);
                    $('#transactionClosing_transactionProperty_yearBuilt').addClass('required_field required');
                } else if (property === 'Vacant_Land') {
                    $(".optional_year").addClass('hidden');
                    $('#transactionClosing_transactionProperty_yearBuilt').prop('required', false);
                    $('#transactionClosing_transactionProperty_yearBuilt').removeClass('required_field required');
                }
                else {
                    $(".custom_box_hoa").hide();
                    $('.hoaOption').find('input').prop('required', false);
                    $(".optional_year").removeClass('hidden');
                    $('#transactionClosing_transactionProperty_yearBuilt').prop('required', true);
                    $('#transactionClosing_transactionProperty_yearBuilt').addClass('required_field required');
                }
            });
        });
        $("#transactionClosing_transactionProperty_property_address_state").val("{{ app.user.businesses[0].address.state }}");
        {% if app.user.businesses[0].id == 2 %}
        $("#transactionClosing_transactionProperty_property_type").append($("<option></option>").attr("value", 'Farm & Ranch').text('Farm & Ranch'));
        {% endif %}
        {% if app.user.businesses[0].id != 50 %}
        //                $("#transactionListing_transactionProperty_property_type").append($("<option></option>").attr("value", 'Apartment').text('Apartment'));
        $("#transactionClosing_transactionProperty_property_type option[value='Apartment']").remove();
        {% endif %}
          // today code  issue 4378
        {% if app.user.businesses[0].id != 50 %}    
            $("#transactionClosing_closing_sellerContact_phone").addClass("donotvalidate");
            $("#transactionClosing_closing_sellerContact_email").addClass("donotvalidate");
        {% else %}
            $("#transactionClosing_closing_sellerContact_phone").removeClass("donotvalidate");
            $("#transactionClosing_closing_sellerContact_email").removeClass("donotvalidate");
        {% endif %}
    </script>

    <script type="text/javascript">
        $(function () {
            $("#transactionClosing_transactionProperty_property_address_zip").on('keyup blur change', function () {
                var zip = $(this).val();
                var zip_regex = /^[0-9]+$/;
                if (!zip.match(zip_regex) || (zip.length) < 1 || (zip.length) > 5) {
                    $('#transactionClosing_transactionProperty_property_address_zip')
                        .closest('.control-group').removeClass('success');
                    $('#transactionClosing_transactionProperty_property_address_zip')
                        .closest('.control-group').addClass('error');
                    $('#zip-error').html('Enter 5 Numbers');
                    $("#transactionClosing_transactionProperty_property_address_zip").focus();
                    return false;
                }
                else {
                    $('#transactionClosing_transactionProperty_property_address_zip')
                        .closest('.control-group').removeClass('error');
                    $('#transactionClosing_transactionProperty_property_address_zip')
                        .closest('.control-group').addClass('success');
                    $('#zip-error').addClass('hidden');
                    return true;
                }
            });
            $("#transactionClosing_transactionProperty_property_address_state").on('keyup blur change', function () {
                var state = $(this).val();
                var state_regex = /^[a-zA-Z]+$/;
                if (!state.match(state_regex) || (state.length) < 1 || (state.length) > 2) {
                    $('#transactionClosing_transactionProperty_property_address_state')
                        .closest('.control-group').removeClass('success');
                    $('#transactionClosing_transactionProperty_property_address_state')
                        .closest('.control-group').addClass('error');
                    $('#state-error').html('Enter 2 Letters');
                    $("#transactionClosing_transactionProperty_property_address_state").focus();
                    return false;
                }
                else {
                    $('#transactionClosing_transactionProperty_property_address_state')
                        .closest('.control-group').removeClass('error');
                    $('#transactionClosing_transactionProperty_property_address_state')
                        .closest('.control-group').addClass('success');
                    $('#state-error').addClass('hidden');
                    return true;
                }
            });
            var form1 = $('#create_form');
            var error1 = $('.alert-error', form1);
            var success1 = $('.alert-success', form1);
            $(form1).validate({
                onkeyup: function (element) {
                    $(element).valid();
                },
                onfocusout: function (element) {
                    $(element).valid();
                },
                errorElement: 'span',
                errorClass: 'help-inline',
                focusInvalid: false,
                ignore: "",
                invalidHandler: function (event, validator) { //display error alert on form submit
                    if($(validator.errorList[0].element).closest('.required_party').css('display') != 'none'){
                        if($(validator.errorList[0].element).closest('.required_party').css('display') == undefined){
                            form.submit();
                        }
                        $(validator.errorList[0].element).focus();
                        success1.hide();
                        error1.show();
                        $('html, body').animate({scrollTop: $('#create_form').offset().top}, 'fast');
                       alert('You have missed one or more required fields. Enter the missing information highlighted in red and try to save the transaction again.');
                   }
                   else{
                       form.submit();
                   }
                },
                highlight: function (element) {
                  //  console.log('highlight');
                    var row = $(element).closest("tr").attr("id");

                    var check = $('#' + row).find(".required").each(function () {
                        var input = $(this).val();
                        if (input == '') {
                            $('#' + row).find(".required_icon_table").css("color", "red");
                            $('#' + row).find(".get_quote").removeClass('hide');
                        }
                    });
                    $(element).closest('.control-group').removeClass('success');
                    $(element).closest('.input-group').removeClass('success');
                    $(element).closest('.control-group').addClass('error');
                    $(element).closest('.input-group').addClass('error');
                    $(element).siblings(".required_icon").css("color", "red");
                    //fix for Seller Closing Contacts email fields
                    {#if($('#' + row).find(".edit-required").length>0){
                        console.log('fvcxfg');
                        $(element).closest('.control-group').addClass('success');
                        $(element).closest('.input-group').addClass('success');
                        $(element).closest('.control-group').removeClass('error');
                        $(element).closest('.input-group').removeClass('error');
                        $(element).closest('.control-group').find('input').css('border-color','green');
                        $(element).siblings(".required_icon").css("color", "green");
                    }#}
                },
                unhighlight: function (element) {
                   // console.log('unhighlight');
                    //fix for Seller attorny field ^@
                    if($(".distinct-input").closest('.control-group').hasClass('success') || $(element).closest('.control-group').hasClass('success'))
                        $(element).css('background-color' , '#fff');
                   {# else
                        $(element).css('background-color' , 'rgb(250, 255, 189)'); //#} //^% remove code to resolve issue 7

                    $(element).closest('.control-group').removeClass('error');
                    $(element).closest('.input-group').removeClass('error');
                    $(element).closest('.control-group').removeClass('optional');
                    $(element).closest('.control-group').addClass('success');
                    $(element).closest('.input-group').addClass('success');
                    $(element).find(".required_icon").css("color", "green");
                    $(element).siblings(".required_icon").css("color", "green");
                    var row = $(element).closest("tr").attr("id");
                    var row_email = $(element).closest("td");

                    var check = $('#' + row).find(".required").each(function () {
                        var input = $(this).val();
                        if (input == '') {
                            $('#' + row).find(".required_icon_table").css("color", "red");
                            $('#' + row).find(".get_quote").removeClass('hide');
                        } else {
                            $('#' + row).find(".required_icon_table").css("color", "green");
                            $('#' + row).find(".get_quote").addClass('hide');
                        }
                    });


                    //fix for Seller Closing Contacts email fields
                    if($(row_email).find(".edit-required").length>0){
                        $(element).closest('.control-group').removeClass('success');
                        $(element).closest('.input-group').removeClass('success');
                        $(element).closest('.control-group').addClass('error');
                        $(element).closest('.input-group').addClass('error');
                        $(element).closest('.control-group').find('input').css('border-color','red');
                        $(element).siblings(".required_icon").css("color", "red");
                    }
                },
                success: function (label) {
                    label.addClass('valid');
                },
                errorPlacement: function (error, element) {
                },
                ignore: ".donotvalidate",
                submitHandler: function (form) {
                    success1.show();
                    error1.hide();
                    $('button:submit').attr("disabled", true);
                    form.submit();
                }
            });

            $(".trans_contacts tbody tr").each(function () {
                checkContactRow($(this));
            });

            {% if mode is not null and mode == 'T' %}
            $("#transactionClosing_closing_type option[value=Lease]").attr('selected', 'selected').parent().blur();
            {% endif %}
            {% if paymentType is not null and mode == 'B' %}
            $("#transactionClosing_closing_type option[value={{ paymentType }}]").attr('selected', 'selected').parent().blur();
            {% endif %}

			$("#transactionClosing_closing_represent").trigger('change');
        });
    </script>

    <script>
        $(document).ready(function () {
            statusSelect = $('#transactionClosing_closing_status');

            {% if transaction.transactionStatus is not null and transaction.transactionStatus != '' and transaction.transactionStatus != 'Active' %}
            statusSelect.val('{{ transaction.transactionStatus }}');
            {% endif %}

            if (statusSelect.val() == 'Contract_fell_thru' {% if app.user.role.level > 4 %} || statusSelect.val() == 'Sold_Paid' {% endif %}) {
                statusSelect.attr('disabled', 'disabled')
            }
            {% if app.user.role.level > 5 and transaction.transactionStatus == 'Sold_not_Paid' %}
            statusSelect.attr('disabled', 'disabled')
            {% endif %}

            statusSelect.on('click', function () {
                var status = $(this).val();
                $(this).data('preStatus', status);
            });
            statusSelect.trigger('click');
            {% if transaction is not null and transaction.listing is not null %}
            statusSelect.on('change', function () {
                var status = $(this).val();
                var access = true;
                if (status == 'Contract_fell_thru') {
                    access = confirm('This will archive your closing file and return the listing to an Active status. Do you wish to proceed?');
                    if (!access) {
                        $(this).val($(this).data('preStatus'))
                    } else {
                        $.post('{{ path('transaction_status_change_ajax') }}/{{ transaction.id }}/Transaction/' + status);
                        return window.location.replace("{{ path('transaction_index') }}");
                    }
                }
            });
            {% endif %}
            {% if mode != 'N' or (closingId is defined and closingId is not null and transaction.closing.represent == 'Seller')  or (closingId is defined and closingId is not null and transaction.closing.represent == 'Landlord') %}
            $('#transactionClosing_closing_buyersAgentContact_contactName').removeClass('hidden');
            $('.select2').addClass('hidden');
            {% endif %}
        });
    </script>

    {% if app.user.businesses[0].id == 50 %}
        <script>
            $(document).ready(function () {
                // $('#transactionClosing_closing_titleCompanyContact_contactName').closest('.control-group').removeClass('error');
                // $('#transactionClosing_closing_titleCompanyContact_contactName').removeClass('required validate-for-row');
                // $('#transactionClosing_closing_titleCompanyContact_phone').closest('.control-group').removeClass('error');
                // $('#transactionClosing_closing_titleCompanyContact_phone').removeClass('required validate-for-row');

                $('#transactionClosing_closing_buyerContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_buyerContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_listingAgentContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_listingAgentContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_listingOfficeContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_listingOfficeContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_sellerContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_sellerContact_email').removeClass('required validate-for-row');
                $('#transactionClosing_closing_sellerContact_phone').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_sellerContact_phone').removeClass('required validate-for-row');
                $('#transactionClosing_closing_buyersAgentContact_email').closest('.control-group').removeClass('error');
                $('#transactionClosing_closing_buyersAgentContact_email').removeClass('required validate-for-row');

                // issue_3495
                setTimeout(function() {


                    $('#transactionClosing_closing_represent').change(function () {
                        if ($('#transactionClosing_closing_represent').val() === 'Seller') {
                            //  alert('yes')
                        }

                    });
                    $('#contact_row_7').removeClass('contact_success');
                    $('#contact_row_7').addClass('contact_error');
                    if($('#transactionClosing_closing_buyerContact_contactName').val()){
                        $('#transactionClosing_closing_buyerContact_contactName').css("background-color", "#fff");
                        $('#transactionClosing_closing_buyerContact_contactName').css("border-color", "#468847");
                    }

                    if($('#transactionClosing_closing_titleCompanyContact_contactName').val()){
                        $('#transactionClosing_closing_titleCompanyContact_contactName').css("background-color", "#fff");
                        $('#transactionClosing_closing_titleCompanyContact_contactName').css("border-color", "#468847");
                    }


                    {#if($('#transactionClosing_closing_buyerContact_phone').val()){
                        $('#transactionClosing_closing_buyerContact_phone').css("background-color", "#fff");
                        $('#transactionClosing_closing_buyerContact_phone').css("border-color", "#468847");
                    }#}
                }, 500);


                $('.lisa').each(function( index ) {
                    if ($( this ).find('input:first').val()){
                        $( this ).removeClass('error');
                        $( this ).addClass('success');
                    }else{
                        $( this ).removeClass('success');
                        $( this ).addClass('error');
                    }

                });

                // validation for only Sellers Attorney name
                 quickFixFields();
                $('#closing-submit').click(function () {

                    setTimeout(function() {

                        $('.lisa').each(function( index ) {

                            if ($( this ).find('input:first').val()){
                                $( this ).removeClass('error');
                                $( this ).addClass('success');
                            }else{
                                $( this ).removeClass('success');
                                $( this ).addClass('error');
                            }

                        });
                             quickFixFields();
                    }, 500);

                })



            });
        </script>
    {% endif %}

{% endblock %}

{% block content %}
    {% import _self as forms %}

    {% macro deposit_widget_prototype(widget, remove_text) %}
    {% import _self as forms %}
        {% if widget.vars.prototype is defined %}
            {% set form = widget.vars.prototype %}
            {% set name = widget.vars.prototype.vars.name %}
        {% else %}
            {% set form = widget %}
            {% set name = widget.vars.full_name %}
        {% endif %}

        {% set randomId = random() %}
        <tr class="deposit-row" data-id="{{ widget.vars.id }}" data-content="{{ widget.vars.id }}_{{ name }}"
            data-target="post_alert_{{ randomId }}"
            data-prototype="{{ forms.deposit_alert_prototype(form.alerts.vars.prototype)|e }}">
            <td>
                <div class="input-group">
                    <span class="input-group-addon">$</span>{{ form_widget(form.amount) }}
                </div>
            </td>
            <td>
                <div class="input-group date date-picker" data-date-format="yyyy-mm-dd">
                    {{ form_widget(form.date) }}
                    <span class="input-group-btn">
                        <button class="btn default" type="button"><i class="fa fa-calendar"></i></button>
                    </span>
                </div>
            </td>
            <td>
                <label class="mt-checkbox mt-checkbox-outline">
                    {{ form_widget(form.depositAlert) }}
                    <span></span>
                </label>
            </td>
            <td>
                <a href="#" class="add-deposit-alert"><i class="icon-plus"></i> Add</a>
            </td>
        </tr>
        <tr class="deposit-alerts-row" id="alert_{{ widget.vars.id }}">
            <td colspan="4">
                <table class="table table-striped alert_deposit hidden">
                    <thead>
                    <tr>
                        <th width="45%"></th>
                        <th width="55%"></th>
                        <th width="5%"></th>
                        <th width="15%"></th>
                    </tr>
                    </thead>
                    <tbody id="post_alert_{{ randomId }}">
                    {% for widget in form.alerts.children %}
                        {{ forms.deposit_alert_prototype(widget, 'Remove alert') }}
                    {% endfor %}
                    </tbody>
                </table>
            </td>
        </tr>
    {% endmacro %}

    {% macro deposit_alert_prototype(widget, remove_text) %}
        {% if widget.vars.prototype is defined %}
            {% set form = widget.vars.prototype %}
            {% set name = widget.vars.prototype.vars.name %}
        {% else %}
            {% set form = widget %}
            {% set name = widget.vars.full_name %}
        {% endif %}

        <tr data-content="{{ widget.vars.id }}_{{ name }}">
            <td width="35%">
                <div class="checkbox-inline">
                    <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                        email
                        {{ form_widget(form.email) }}
                        <span></span>
                    </label>
                    <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                        text
                        {{ form_widget(form.phone) }}
                        <span></span>
                    </label>
                </div>
            </td>
            <td width="45%">
                <div class="input-group date form_meridian_datetime form_datetime bs-datetime">
                    {{ form_widget(form.date) }}
                    <span class="input-group-addon">
                        <button style="margin-right: 0;" class="btn default date-reset" type="button"><i class="fa fa-times"></i></button>
                    </span>
                    <span class="input-group-addon">
                        <button style="margin-right: 0;" class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
                    </span>
                </div>
            </td>
            <td width="5%"></td>
            <td width="15%">
                <div class="btn-group" role="group">
                    <a data-related="{{ widget.vars.id }}_{{ name }}" class="btn btn-danger btn-remove">
                        <i class="fa fa-trash-o"></i>
                    </a>
                </div>
            </td>
        </tr>
    {% endmacro %}

    {% macro event_widget_prototype(widget, remove_text) %}
        {% import _self as forms %}
        {% if widget.vars.prototype is defined %}
            {% set form = widget.vars.prototype %}
            {% set name = widget.vars.prototype.vars.name %}
        {% else %}
            {% set form = widget %}
            {% set name = widget.vars.full_name %}
        {% endif %}

        {% set randomId = random() %}

        <tr class="event-row" id="{{ widget.vars.id }}" data-id="{{ widget.vars.id }}"
            data-content="{{ widget.vars.id }}_{{ name }}" data-target="post_event_alert_{{ randomId }}"
            data-prototype="{{ forms.event_alert_prototype(form.alerts.vars.prototype)|e }}">
            <td>
                <div class="input-group">
                    {{ form_widget(form.title) }}
                </div>
            </td>
            <td>
                <div class="input-group date date-picker" data-date-format="yyyy-mm-dd">
                    {{ form_widget(form.time) }}
                    <span class="input-group-btn">
                        <button class="btn default" type="button"><i class="fa fa-calendar"></i></button>
                    </span>
                    <span id="name-error" class="help-block help-block-error" style="display: none;">
                        This field is required.
                    </span>
                </div>
            </td>
            <td>
                <div style="display: none;" class="checkbox">
                    <span class="">
                        {{ form_widget(form.alert) }}
                    </span>
                </div>
            </td>
            <td><a href="#" class="add-event-alert"><i class="icon-plus"></i> Add</a></td>
        </tr>
        <tr class="event-alerts-row" id="alert_{{ widget.vars.id }}">
            <td colspan="4">
                <table class="table table-striped alert_event hidden">
                    <thead>
                    <tr>
                        <th width="45%"></th>
                        <th width="55%"></th>
                        <th width="5%"></th>
                        <th width="15%"></th>
                    </tr>
                    </thead>
                    <tbody id="post_event_alert_{{ randomId }}">
                    {% for widget in form.alerts.children %}
                        {{ forms.event_alert_prototype(widget, 'Remove alert') }}
                    {% endfor %}
                    </tbody>
                </table>
            </td>
        </tr>
    {% endmacro %}

    {% macro event_alert_prototype(widget, remove_text) %}
        {% if widget.vars.prototype is defined %}
            {% set form = widget.vars.prototype %}
            {% set name = widget.vars.prototype.vars.name %}
        {% else %}
            {% set form = widget %}
            {% set name = widget.vars.full_name %}
        {% endif %}

        <tr data-content="{{ widget.vars.id }}_{{ name }}">
            <td width="35%">
                <div class="checkbox-list">
                    <div class="checkbox-inline">
                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                            email
                            {{ form_widget(form.email) }}
                            <span></span>
                        </label>
                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                            text
                            {{ form_widget(form.phone) }}
                            <span></span>
                        </label>
                    </div>
                </div>
            </td>
            <td width="45%">
                <div class="input-group date form_meridian_datetime form_datetime bs-datetime">
                    {{ form_widget(form.date) }}
                    <span class="input-group-addon">
                        <button style="margin-right: 0;" class="btn default date-reset" type="button"><i class="fa fa-times"></i></button>
                    </span>
                    <span class="input-group-addon">
                        <button style="margin-right: 0;" class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
                    </span>
                </div>
            </td>
            <td width="5%">


            </td>
            <td width="15%">
                <div class="btn-group" role="group">
                    <a data-related="{{ widget.vars.id }}_{{ name }}" class="btn btn-danger btn-remove">
                        <i class="fa fa-trash-o"></i>
                    </a>
                </div>
            </td>
        </tr>
    {% endmacro %}

    {% if closingId is not null %}
        <div class="row" style="margin-bottom: 10px;">
            <div class="col-md-9">
                <a class="btn btn-warning" href="{{ path('transaction_view', {'id': transaction.id}) }}">
                    <i class="icon-action-undo"></i> Back to Transaction
                </a>
            </div>
        </div>
    {% endif %}

    <div class="form create_transaction">
        {{ form_start(form, { 'attr': {'novalidate': 'novalidate','class': 'form-bordered form-horizontal create_form', 'id': 'create_form', 'data-type': 'closing', 'onkeypress': 'return event.keyCode != 13;'} }) }}
        <div class="row">
            <div class="col-md-9">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon-home"></i> Property Information </div>
                    </div>
                    <div class="portlet-body gradient-bg">
                        <div class="row">
                            <div class="col-md-6">
                                {% if (app.user.businesses[0].id in [19]) %}
                                    <div class="control-group error">
                                        {{ form_widget(form.transactionProperty.mlsNumber, {'attr': {'required': 'required', 'class': 'form-control placeholder-no-fix required_field required'}}) }}
                                    </div>
                                {% else %}
                                    <div class="form-group">
                                        {{ form_widget(form.transactionProperty.mlsNumber) }}
                                    </div>
                                {% endif %}
                                <span class="help-block">
                                    {{ form_errors(form.transactionProperty.mlsNumber) }}
                                </span>
                            </div>

                            {% if checker.forAddon('auto fill', app.user) %}
                                <div class="col-md-4 {% if (app.user.businesses[0].id not in [1, 2, 19, 23, 50, 54]) %}hidden{% endif %}">
                                    <a href="#" class="btn blue " id="fetch_mls" data-user="{{ app.user.id }}"
                                       name="fetch_mls"><i class="icon-share-alt"></i> Autofill MLS</a>
                                </div>
                            {% endif %}

                            <div class="col-md-2">
                                {% if transaction.transactionProperty is not null and transaction.transactionProperty.primaryMlsNumber is not null and transaction.transactionProperty.pMlsNumber is not null %}
                                    <h4>{{ transaction.transactionProperty.pMlsNumber }}</h4>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-9">
                                <div class="control-group {% if form.vars.value.transactionProperty.property.address.street is defined %}success{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if form.vars.value.transactionProperty.property.address.street is defined %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.transactionProperty.property.address.street) }}
                                        <span class="help-block">
                                            {{ form_errors(form.transactionProperty.property.address.street) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                {{ form_widget(form.transactionProperty.mlsBoard) }}
                                <span class="help-block">
                                    {{ form_errors(form.transactionProperty.mlsBoard) }}
                                </span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-7">
                                <div class="control-group {% if form.vars.value.transactionProperty.property.address.city is defined %}success{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if form.vars.value.transactionProperty.property.address.city is defined %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.transactionProperty.property.address.city) }}
                                        <span class="help-block">
                                            {{ form_errors(form.transactionProperty.property.address.city) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="control-group {% if form.vars.value.transactionProperty.property.address.state is defined %}success{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if form.vars.value.transactionProperty.property.address.state is defined %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.transactionProperty.property.address.state) }}
                                        <span class="help-block" id="state-error">
                                            {{ form_errors(form.transactionProperty.property.address.state) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="control-group {% if form.vars.value.transactionProperty.property.address.zip is defined %}success{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if form.vars.value.transactionProperty.property.address.zip is defined %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.transactionProperty.property.address.zip) }}
                                        <span class="help-block" id="zip-error">
                                            {{ form_errors(form.transactionProperty.property.address.zip) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-9">
                                <div class="control-group {% if form.vars.value.transactionProperty.property.type is defined %}success{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if form.vars.value.transactionProperty.property.type is defined %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.transactionProperty.property.type) }}
                                        <span class="help-block">
                                            {{ form_errors(form.transactionProperty.property.type) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 optional_year">
                                <div class="control-group {% if form.vars.value.transactionProperty.yearBuilt is defined and form.vars.value.transactionProperty.yearBuilt is not empty %}success{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if form.vars.value.transactionProperty.yearBuilt is defined and form.vars.value.transactionProperty.yearBuilt is not empty %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.transactionProperty.yearBuilt) }}
                                        <span class="help-block">
                                            {{ form_errors(form.transactionProperty.yearBuilt) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="icon-info"></i> Closing Information
                        </div>
                    </div>
                    <div class="portlet-body gradient-bg">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="control-group {% if closingId is not null %}{% if form.vars.value.closing.represent is defined and form.vars.value.closing.represent is not empty %}success{% else %}error{% endif %}{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if closingId is not null %}{% if form.vars.value.closing.represent is defined and form.vars.value.closing.represent is not empty %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.closing.represent) }}
                                        <span class="help-block">
                                            {{ form_errors(form.closing.represent) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="control-group {% if closingId is not null %}{% if form.vars.value.closing.type is defined and form.vars.value.closing.type is not empty %}success{% else %}error{% endif %}{% else %}error{% endif %}">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon"
                                           style="{% if closingId is not null %}{% if form.vars.value.closing.type is defined and form.vars.value.closing.type is not empty %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {{ form_widget(form.closing.type) }}
                                        <span class="help-block">
                                            {{ form_errors(form.closing.type) }}
                                        </span>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="row">

                            <div class="col-md-12">
                                <div class="control-group success">
                                    <div class="controls">
                                        <i class="fa fa-asterisk required_icon" style="color:rgb(0, 128, 0);margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                        {% if closingId is null and app.user.businesses.first.id == 50 and app.user.role.level == 7 %}
                                            <input type="hidden" name="transactionClosing[closing][status]" value="Pending">
                                            {{ form_widget(form.closing.status, {'attr': {'disabled': 'disabled'}}) }}
                                        {% else %}
                                            {% if app.user.role.level > 5 and (transaction.transactionStatus == 'Sold_not_Paid' or transaction.transactionStatus == 'Leased_not_Paid') %}
                                                <input type="hidden" name="transactionClosing[closing][status]" value="{{ transaction.transactionStatus }}">
                                            {% endif %}
                                            {{ form_widget(form.closing.status) }}
                                        {% endif %}
                                        <span class="help-block">
                                            {{ form_errors(form.closing.status) }}
                                        </span>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="form-group custom_box_hoa">
                            <label class="control-label">
                                <i class="fa fa-asterisk required_icon_table hoaQuestion"></i>
                                {{ hoaQuestion.question }}
                            </label>

                            <div class="col-md-12">
                                <div class="radio-list">
                                    <div class="mt-radio-inline">
                                        <label class="mt-radio mt-radio-outline">
                                            {{ form_label(form.closing.hoa[0]) }}
                                            {{ form_widget(form.closing.hoa[0]) }}
                                            <span></span>
                                        </label>
                                        <label class="mt-radio mt-radio-outline">
                                            {{ form_label(form.closing.hoa[1]) }}
                                            {{ form_widget(form.closing.hoa[1]) }}
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-navicon"></i> Closing Contacts
                        </div>
                    </div>
                    <div class="portlet-body no-more-tables ">
                        <div id="trans_contacts_wrapper" class="dataTables_wrapper form-inline no-footer">
                            <table class="display table table-hover table-bordered table-condensed cf trans_contacts dataTable no-footer" cellspacing="0" width="100%" style="margin-bottom: 0 !important;">
                                <thead class="cf">
                                <tr role="row">
                                    <th style="width: 160px;" class="sorting_asc" rowspan="1" colspan="1"
                                        aria-label=" Contact Role"><i class="icon-key table_form_icon"></i> Contact Role
                                    </th>
                                    <th style="width: 250px;" class="sorting" rowspan="1" colspan="1"
                                        aria-label=" Contact"><i class="icon-user table_form_icon"></i> Contact
                                    </th>
                                    <th style="width: 190px;" class="sorting" rowspan="1" colspan="1"
                                        aria-label=" Phone #"><i class="icon-phone table_form_icon"></i> Phone #
                                    </th>
                                    <th style="width: 190px;" class="sorting" rowspan="1" colspan="1"
                                        aria-label=" Email"><i class="icon-envelope-alt table_form_icon"></i> Email
                                    </th>
                                    <th style="width: 190px;" class="sorting" rowspan="1" colspan="1"
                                        aria-label=" Email"><i class="icon-envelope-alt table_form_icon"></i> Company
                                    </th>

                                </tr>
                                </thead>

                                <tbody>
                                <tr class="required_party toggle_control even" id="contact_row_1" role="row">
                                    <td data-title="Role" id="1">
                                        <i class="fa fa-asterisk contact_status buyerAgent"
                                           style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>
                                        <span class="contact_type">Buyers Agent</span>
                                    </td>

                                    <td data-title="Contact">
                                        <div class="control-group ">
                                            <div class="controls buyerAgent">
                                                {% if creatorAgent is not null %}
                                                    {% set firstValue = creatorAgent.firstname~' '~creatorAgent.lastname %}
                                                {% else %}
                                                    {% set firstValue = app.user.firstname~' '~app.user.lastname %}
                                                {% endif %}
                                                <select name="selectedAgentId" type="hidden" class="js-data-example-ajax select2 form-control">
                                                    <option value="{% if creatorAgent is not null %}{{ creatorAgent.id }}{% else %}{{ app.user.id }}{% endif %}" selected="selected">{{ firstValue }}</option>
                                                </select>
                                                {{ form_widget(form.closing.buyersAgentContact.contactName, { 'attr': {'value': firstValue, 'class': 'hidden form-control placeholder-no-fix', 'style': 'width:100%;'} }) }}
                                                {#<input type="hidden" name="transactionClosing[closing][buyersAgentContact][contactName]" id="buyerAgentId" value>#}
                                                <span class="help-block">
                                                    {{ form_errors(form.closing.buyersAgentContact.contactName) }}
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyersAgentContact.phone, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row phone', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                    {{ form_errors(form.closing.buyersAgentContact.phone) }}
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Email">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyersAgentContact.email, { 'attr': {'class': 'form-control placeholder-no-fix required edit-require validate-for-row lisafield', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.buyersAgentContact.email) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Company">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyersAgentContact.company, { 'attr': {'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                {{ form_errors(form.closing.buyersAgentContact.company) }}
                                            </span>
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                                <tr class="required_party toggle_control odd" id="contact_row_2" role="row">
                                    <td data-title="Role" id="2">
                                        <i class="fa fa-asterisk contact_status buyerOffice"
                                           style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>

                                        <span class="contact_type">Buyers Office</span>
                                    </td>
                                    <td data-title="Contact">
                                        <div class="control-group ">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyersOfficeContact.contactName, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.buyersOfficeContact.contactName) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyersOfficeContact.phone, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row phone', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.buyersOfficeContact.phone) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Email">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyersOfficeContact.email, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row lisafield', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.buyersOfficeContact.email) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Company ">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyersOfficeContact.company, { 'attr': { 'style': 'width:100%;' } }) }}
                                                <span class="help-block">
                                                {{ form_errors(form.closing.buyersOfficeContact.company) }}
                                            </span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="required_party toggle_control odd" id="contact_row_0" role="row">

                                    <td data-title="Role" id="0">
                                        <i class="fa fa-asterisk contact_status buyer"
                                           style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>
                                        <span class="contact_type change_buyer_by_represent">Buyer</span>
                                    </td>
                                    <td data-title="Contact">
                                        <div class="control-group remote ">
                                            <div class="controls ">
                                                {{ form_widget(form.closing.buyerContact.contactName, { 'attr': {'data-agent': '', 'class': 'form-control typeahead required validate-for-row  placeholder-no-fix', 'placeholder': app.user.role.level <7 ? 'Set agent first to autofill contact' : 'Name', 'style': 'width:100%;'} }) }}
                                            </div>
                                        </div>
                                        <div class="control-group remote lisa">
                                            <div class="controls ">
                                                <!--  we show fields related to CRR business only  -->
                                                {% if app.user.businesses[0].id == 50 %}
                                                    {{ form_widget(form.closing.buyerContact.address.street, { 'attr': {'class': 'form-control typeahead required validate-for-row ', 'style': 'width:100%;margin-top:4%;' } }) }}
                                                {% endif %}

                                                <span class="help-block">
                                                        {{ form_errors(form.closing.buyerContact.contactName) }}

                                                    </span>
                                            </div>
                                        </div>

                                    </td>
                                    <td data-title="Phone Number">
                                        <div id="remote-buyer-phone" class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyerContact.phone, { 'attr': {'class': 'form-control placeholder-no-fix ajax-phone required validate-for-row phone lisafield', 'style': 'width:100%;'} }) }}
                                             </div>
                                        </div>
                                                <!--  we show fields related to CRR business only  -->
                                            
                                                {% if app.user.businesses[0].id == 50 %}
                                                    <div class="control-group lisa">
                                                        <div class="controls">
                                                    {{ form_widget(form.closing.buyerContact.address.city, { 'attr': { 'class':'form-control placeholder-no-fix ajax-phone lisafield','style': 'width:100%;margin-top:4%;' } }) }}
                                                        </div></div>
                                                {% endif %}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.buyerContact.phone) }}
                                                    </span>
                                           
                                        
                                    </td>
                                    <td data-title="Email">
                                        <div id="remote-buyer-email" class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyerContact.email, { 'attr': {'class': 'form-control placeholder-no-fix ajax-email required validate-for-row ', 'style': 'width:100%;'} }) }}
                                            </div>
                                        </div>


                                        <!--  we show fields related to CRR business only  -->
                                        {% if app.user.businesses[0].id == 50 %}
                                            <div class="control-group lisa">
                                                <div class="controls">
                                                    {{ form_widget(form.closing.buyerContact.address.state, { 'attr': {'class': 'form-control typeahead required validate-for-row ', 'style': 'width:100%;margin-top:4%;' } }) }}
                                                </div>
                                            </div>
                                        {% endif %}

                                        <span class="help-block">
                                                        {{ form_errors(form.closing.buyerContact.email) }}
                                                    </span>

                                    </td>

                                    <td data-title="Company">
                                        <div class="control-group ">
                                            <div class="controls">
                                                {{ form_widget(form.closing.buyerContact.company, { 'attr': {'style': 'width:100%;'} } ) }}

                                                <!--  we show fields related to CRR business only  -->
                                                {% if app.user.businesses[0].id == 50 %}
                                                    <div  class="control-group lisa">
                                                        {{ form_widget(form.closing.buyerContact.address.zip, { 'attr': { 'style': 'width:100%; margin-top:4%;' } }) }}
                                                    </div>
                                                {% endif %}
                                                <span class="help-block">
                                                {{ form_errors(form.closing.buyerContact.company) }}
                                            </span>
                                            </div>
                                        </div>

                                    </td>

                                </tr>

                                {% if app.user.businesses[0].id == 50 %}
                                    <tr class="required_party toggle_control odd" id="contact_row_0_00" role="row">

                                        <td data-title="Role" id="0_00">

                                            <span class="contact_type change_buyer_by_represent">Buyer 2</span>
                                        </td>
                                        <td data-title="Contact">
                                            <div class="control-group remote buyer2">
                                                <div class="controls buyer">
                                                    {{ form_widget(form.closing.buyerContact2.contactName, { 'attr': {'data-agent': '', 'class': 'form-control typeahead placeholder-no-fix', 'placeholder': app.user.role.level <7 ? 'Set agent first to autofill contact' : 'Name', 'style': 'width:100%;'} }) }}
                                                    {{ form_widget(form.closing.buyerContact2.address.street, { 'attr': { 'style': 'width:100%;margin-top:4%;' } }) }}
                                                    <span class="help-block">
                                                        {{ form_errors(form.closing.buyerContact2.contactName) }}
                                                    </span>
                                                </div>
                                            </div>
                                        </td>
                                        <td data-title="Phone Number">
                                            <div id="remote-buyer-phone" class=" ">
                                                <div class="controls">
                                                    {{ form_widget(form.closing.buyerContact2.phone, { 'attr': {'class': 'form-control placeholder-no-fix ajax-phone phone', 'style': 'width:100%;'} }) }}
                                                    {{ form_widget(form.closing.buyerContact2.address.city, { 'attr': { 'style': 'width:100%;margin-top:4%;' } }) }}
                                                    <span class="help-block">
                                                        {{ form_errors(form.closing.buyerContact2.phone) }}
                                                    </span>
                                                </div>
                                            </div>
                                        </td>
                                        <td data-title="Email">
                                            <div id="remote-buyer-email" class=" ">
                                                <div class="controls">
                                                    {{ form_widget(form.closing.buyerContact2.email, { 'attr': {'class': 'form-control placeholder-no-fix ajax-email ', 'style': 'width:100%;'} }) }}
                                                    {{ form_widget(form.closing.buyerContact2.address.state, { 'attr': { 'style': 'width:100%;margin-top:4%;' } }) }}
                                                    <span class="help-block">
                                                        {{ form_errors(form.closing.buyerContact2.email) }}
                                                    </span>
                                                </div>
                                            </div>
                                        </td>

                                        <td data-title="Company">
                                            {{ form_widget(form.closing.buyerContact2.company, { 'attr': {'style': 'width:100%;'} } ) }}
                                            {{ form_widget(form.closing.buyerContact2.address.zip, { 'attr': { 'style': 'width:100%;margin-top:4%;' } }) }}
                                            <span class="help-block">
                                                {{ form_errors(form.closing.buyerContact2.company) }}
                                            </span>
                                        </td>

                                    </tr>
                                {% endif %}
                                <tr class="required_party toggle_control even" id="contact_row_5" role="row">
                                    <td data-title="Role" id="5">
                                        <i class="fa fa-asterisk contact_status agent"
                                           style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>

                                        <span class="contact_type">Listing Agent</span>
                                    </td>
                                    <td data-title="Contact">
                                        <div class="control-group ">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingAgentContact.contactName, { 'attr': {'class': 'form-control placeholder-no-fix required', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.listingAgentContact.contactName) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        <div class="control-group ">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingAgentContact.phone, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row phone', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.listingAgentContact.phone) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Email">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingAgentContact.email, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.listingAgentContact.email) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Company">
                                        <div id="remote-buyer-email" class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingAgentContact.company, { 'attr': {'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                {{ form_errors(form.closing.listingAgentContact.company) }}
                                            </span>
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                                <tr class="required_party toggle_control odd" id="contact_row_6" role="row">
                                    <td data-title="Role" id="6">
                                        <i class="fa fa-asterisk contact_status office"
                                           style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>

                                        <span class="contact_type">Listing Office</span>
                                    </td>
                                    <td data-title="Contact">
                                        <div class="control-group ">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingOfficeContact.contactName, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.listingOfficeContact.contactName) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        <div class="control-group ">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingOfficeContact.phone, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row phone', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.listingOfficeContact.phone) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Email">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingOfficeContact.email, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.listingOfficeContact.email) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Company">
                                        <div id="remote-buyer-email" class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.listingOfficeContact.company, { 'attr': { 'style': 'width:100%;' } }) }}
                                                <span class="help-block">
                                                {{ form_errors(form.closing.listingOfficeContact.company) }}
                                            </span>
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                                <tr class="required_party toggle_control odd" id="contact_row_4" role="row">
                                    <td data-title="Role" id="4">
                                        <i class="fa fa-asterisk contact_status seller"
                                           style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>
                                        <span class="contact_type change_seller_by_represent">Seller</span>
                                    </td>
                                    <td data-title="Contact">
                                        <div class="control-group lisa">
                                            <div class="controls seller">
                                                {{ form_widget(form.closing.sellerContact.contactName, { 'attr': {'class': 'form-control typeahead placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.sellerContact.contactName) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        <div class="control-group sellerPhoneChange lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.sellerContact.phone, { 'attr': {'class': 'lisafield form-control placeholder-no-fix required validate-for-row phone', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.sellerContact.phone) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Email">
                                        <div class="control-group sellerEmailChange lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.sellerContact.email, { 'attr': {'class': 'lisafield form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.sellerContact.email) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Company">
                                        <div class="control-group sellerEmailChange">
                                            <div class="controls">
                                                {{ form_widget(form.closing.sellerContact.company, { 'attr': {'class':' form-control placeholder-no-fix ' , 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                {{ form_errors(form.closing.sellerContact.company) }}
                                            </span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="required_party toggle_control even" id="contact_row_7" data-id="5"
                                    role="row">
                                    <td data-title="Role" id="7">

                                        <i class="fa fa-asterisk contact_status titleCompany" style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>

                                        {% if (app.user.businesses[0].id == 50) %}
                                            <span class="contact_type">Sellers Attorney</span>
                                        {% else %}
                                            <span class="contact_type">Title Company</span>
                                        {% endif %}
                                    </td>

                                    <td data-title="Contact">
                                        <div class="control-group titleCompany lisa">
                                            {{ form_widget(form.closing.titleCompanyContact.contactName, { 'attr': {'class': 'form-control placeholder-no-fix typeahead required validate-for-row', 'style': 'width:100%;'} }) }}
                                            <span class="help-block">
                                                {{ form_errors(form.closing.titleCompanyContact.contactName) }}
                                            </span>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.titleCompanyContact.phone, { 'attr': {'class': 'form-control placeholder-no-fix phone required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.titleCompanyContact.phone) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Email">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.titleCompanyContact.email, { 'attr': {'class': 'lisafield form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
                                                        {{ form_errors(form.closing.titleCompanyContact.email) }}
                                                    </span>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-title="Company">
                                        <div class="control-group lisa">
                                            <div class="controls">
                                                {{ form_widget(form.closing.titleCompanyContact.company, { 'attr': { 'style': 'width:100%;' } }) }}
                                                <span class="help-block">
													{{ form_errors(form.closing.titleCompanyContact.company) }}
												</span>
                                            </div>
                                        </div>

                                    </td>
                                </tr>
                                <!--code  for seller  att start -->
                                {% if (app.user.businesses[0].id == 50) %}
                                    <tr class="required_party toggle_control even" id="contact_row_15" data-id="15"
                                        role="row">
                                        <td data-title="Role" id="15">
                                            <i class="fa fa-asterisk contact_status sellerattorneyCompany" style="font-size: 9px; z-index: 3;position: absolute; margin-top: -10px; margin-left: -10px;"></i>
                                            <span class="contact_type">Buyers Attorney</span>
                                        </td>
                                        <td data-title="Contact">
                                            <div class="control-group sellerattorneyCompany lisa">
                                                {{ form_widget(form.closing.sellerattorneyCompanyContact.contactName, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                <span class="help-block">
													{{ form_errors(form.closing.sellerattorneyCompanyContact.contactName) }}
												</span>
                                            </div>
                                        </td>
                                        <td data-title="Phone Number">
                                            <div class="control-group lisa">
                                                <div class="controls">
                                                    {{ form_widget(form.closing.sellerattorneyCompanyContact.phone, { 'attr': {'class': 'form-control placeholder-no-fix phone required validate-for-row', 'style': 'width:100%;'} }) }}
                                                    <span class="help-block">
                                                        {{ form_errors(form.closing.sellerattorneyCompanyContact.phone) }}
                                                    </span>
                                                </div>
                                            </div>
                                        </td>
                                        <td data-title="Email">
                                            <div class="control-group lisa">
                                                <div class="controls">
                                                    {{ form_widget(form.closing.sellerattorneyCompanyContact.email, { 'attr': {'class': 'form-control placeholder-no-fix required validate-for-row', 'style': 'width:100%;'} }) }}
                                                    <span class="help-block">
                                                        {{ form_errors(form.closing.sellerattorneyCompanyContact.email) }}
                                                    </span>
                                                </div>
                                            </div>
                                        </td>
                                        <td data-title="Company">
                                            <div class="control-group lisa">
                                                <div class="controls">
                                                    {{ form_widget(form.closing.sellerattorneyCompanyContact.company, { 'attr': { 'style': 'width:100%;' } }) }}
                                                    <span class="help-block">
													{{ form_errors(form.closing.sellerattorneyCompanyContact.company) }}
												</span>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                {% endif %}
                                <!-- code for  seller att   End   -->

                                <tr class="required_party toggle_control odd" id="contact_row_8" role="row">
                                    <td data-title="Role" id="8">
                                        <i class="icon-asterisk required_icon_table "
                                           style="color: rgb(255, 0, 0);"></i>
                                        <span class="contact_type">Escrow Company</span>
                                    </td>

                                    <td data-title="Contact">
                                        <div class="control-group escrowCompany">
                                            {{ form_widget(form.closing.escrowCompanyContact.contactName, { 'attr': {'style': 'width:100%;'} } ) }}
                                            <span class="help-block">
                                                {{ form_errors(form.closing.escrowCompanyContact.contactName) }}
                                            </span>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        {{ form_widget(form.closing.escrowCompanyContact.phone, { 'attr': { 'style': 'width:100%;' } }) }}
                                        <span class="help-block">
											{{ form_errors(form.closing.escrowCompanyContact.phone) }}
										</span>
                                    </td>
                                    <td data-title="Email">
                                        {{ form_widget(form.closing.escrowCompanyContact.email, { 'attr':  { 'style': 'width:100%;' }}) }}
                                        <span class="help-block">
											{{ form_errors(form.closing.escrowCompanyContact.email) }}
										</span>
                                    </td>
                                    <td data-title="Company">
                                        {{ form_widget(form.closing.escrowCompanyContact.company, { 'attr': { 'style': 'width:100%;' } }) }}
                                        <span class="help-block">
											{{ form_errors(form.closing.escrowCompanyContact.company) }}
										</span>
                                    </td>
                                </tr>
                                <tr class="required_party toggle_control even" id="contact_row_9" role="row">
                                    <td data-title="Role" id="9">
                                        <i class="icon-asterisk required_icon_table "
                                           style="color: rgb(0, 128, 0);"></i>
                                        <span class="contact_type">Home Inspector</span>
                                    </td>

                                    <td data-title="Contact">
                                        <div class="control-group homeInspector">
                                            {{ form_widget(form.closing.homeInspectorContact.contactName, { 'attr': {'style': 'width:100%;'} }) }}
                                            <span class="help-block">
                                                    {{ form_errors(form.closing.homeInspectorContact.contactName) }}
                                                </span>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        <div id="remote">
                                            {{ form_widget(form.closing.homeInspectorContact.phone, { 'attr': { 'style': 'width:100%;' } }) }}
                                            <span class="help-block">
                                                    {{ form_errors(form.closing.homeInspectorContact.phone) }}
                                                </span>
                                        </div>
                                    </td>
                                    <td data-title="Email">
                                        <div id="remote">
                                            {{ form_widget(form.closing.homeInspectorContact.email, { 'attr': { 'style': 'width:100%;' } }) }}
                                            <span class="help-block">
                                                    {{ form_errors(form.closing.homeInspectorContact.email) }}
                                                </span>
                                        </div>
                                    </td>
                                    <td data-title="Company">
                                        {{ form_widget(form.closing.homeInspectorContact.company, { 'attr': { 'style': 'width:100%;' } }) }}
                                        <span class="help-block">
                                                {{ form_errors(form.closing.homeInspectorContact.company) }}
                                            </span>
                                    </td>
                                </tr>
                                <tr class="required_party toggle_control odd" id="contact_row_10" role="row">
                                    <td data-title="Role" id="10">
                                        <i class="icon-asterisk required_icon_table "
                                           style="color: rgb(0, 128, 0);"></i>

                                        <span class="contact_type">Home Insurance</span>
                                    </td>

                                    <td data-title="Contact">
                                        <div class="control-group homeInsurance">
                                            {{ form_widget(form.closing.homeInsuranceContact.contactName, { 'attr': {'style': 'width:100%;'} }) }}
                                            <span class="help-block">
                                                {{ form_errors(form.closing.homeInsuranceContact.contactName) }}
                                            </span>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        {{ form_widget(form.closing.homeInsuranceContact.phone, { 'attr': {'style': 'width:100%;'} }) }}
                                        <span class="help-block">
                                                {{ form_errors(form.closing.homeInsuranceContact.phone) }}
                                            </span>
                                    </td>
                                    <td data-title="Email">
                                        {{ form_widget(form.closing.homeInsuranceContact.email, { 'attr': {'style': 'width:100%;'} }) }}
                                        <span class="help-block">
                                                {{ form_errors(form.closing.homeInsuranceContact.email) }}
                                            </span>
                                    </td>
                                    <td data-title="Company">
                                        {{ form_widget(form.closing.homeInsuranceContact.company, { 'attr': {'style': 'width:100%;'} }) }}
                                        <span class="help-block">
                                                {{ form_errors(form.closing.homeInsuranceContact.company) }}
                                            </span>
                                    </td>
                                </tr>
                                <tr class="required_party toggle_control even" id="contact_row_11" data-id="5"
                                    role="row">
                                    <td data-title="Role" id="11">
                                        <i class="icon-asterisk required_icon_table "
                                           style="color: rgb(255, 0, 0);"></i>

                                        <span class="contact_type">Lender</span>

                                    </td>

                                    <td data-title="Contact">
                                        <div class="control-group lender">
                                            {{ form_widget(form.closing.lenderContact.contactName, { 'attr': {'style': 'width:100%;'} }) }}
                                            <span class="help-block">
                                                {{ form_errors(form.closing.lenderContact.contactName) }}
                                            </span>
                                        </div>
                                    </td>
                                    <td data-title="Phone Number">
                                        {{ form_widget(form.closing.lenderContact.phone , { 'attr': {'style': 'width:100%;'} }) }}
                                        <span class="help-block">
                                                {{ form_errors(form.closing.lenderContact.phone) }}
                                            </span>
                                    </td>
                                    <td data-title="Email">
                                        {{ form_widget(form.closing.lenderContact.email, { 'attr': {'style': 'width:100%;'} }) }}
                                        <span class="help-block">
                                                {{ form_errors(form.closing.lenderContact.email) }}
                                            </span>
                                    </td>
                                    <td data-title="Company">
                                        {{ form_widget(form.closing.lenderContact.company, { 'attr': {'style': 'width:100%;'} }) }}
                                        <span class="help-block">
                                                {{ form_errors(form.closing.lenderContact.company) }}
                                            </span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="portlet box blue tabbable " id="note_box">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-comments"></i> Notes
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="tabbable portlet-tabs">
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#portlet_tab_1" data-toggle="tab"><label
                                                class="control-label">Transaction</label></a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="portlet_tab_1">
                                    <div class="control-group">
                                        <div class="controls">
                                            {{ form_widget(form.closing.transactionNote.note) }}
                                            <span class="help-block">
                                                {{ form_errors(form.closing.transactionNote.note) }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="mt-checkbox-list">
                                        <label class="mt-checkbox mt-checkbox-outline">
                                            {{ form_label(form.closing.transactionNote.important) }}
                                            {{ form_widget(form.closing.transactionNote.important) }}
                                            <span></span>
                                        </label>
                                        <label class="mt-checkbox mt-checkbox-outline">
                                            {{ form_label(form.closing.transactionNote.private) }}
                                            {{ form_widget(form.closing.transactionNote.private) }}
                                            <span></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-calendar"></i> Events
                        </div>
                        <div class="actions">
                            <div class="btn-group">
                                <a class="btn btn-danger  btn-add" data-target="post_event">
                                    <i class="icon-plus"></i> Add
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="portlet-body gradient-bg">
                        <div class="form-group">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th width="45%">Event Name</th>
                                    <th width="40%">Date</th>
                                    <th width="5%">Alert</th>
                                    <th width="15%"></th>
                                </tr>
                                </thead>
                                <tbody id="post_event" data-prototype="{{ forms.event_widget_prototype(form.closing.closingContacts, 'Remove event')|escape }}">
                                {% for widget in form.closing.closingContacts.children %}
                                    {{ forms.event_widget_prototype(widget, 'Remove deposit') }}
                                {% endfor %}
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                {% if otherQuestions|length > 0 %}
                    <div class="portlet box blue">
                        <div class="portlet-title">
                            <div class="caption">
                                <i class="fa fa-question"></i> Questions
                            </div>
                        </div>
                        <div class="portlet-body gradient-bg">
                            {% for question in otherQuestions %}
                                {% include('@LocalsBestUser/transaction/_question-block.html.twig') %}
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <div class="portlet box blue">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="fa fa-money"></i> Financial Information
                        </div>
                    </div>
                    <div class="portlet-body gradient-bg">
                        <div class="input-group control-group {% if form.vars.value.closing.moneyBox.contractPrice is defined and form.vars.value.closing.moneyBox.contractPrice is not null and form.vars.value.closing.moneyBox.contractPrice != '' %}success{% else %}error{% endif %}">
                            <span class="input-group-addon">Contract Price</span>
                            <i class="fa fa-asterisk required_icon"
                               style="{% if form.vars.value.closing.moneyBox.contractPrice is defined and form.vars.value.closing.moneyBox.contractPrice is not null and form.vars.value.closing.moneyBox.contractPrice != '' %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                            {{ form_widget(form.closing.moneyBox.contractPrice) }}
                            <span class="help-block">
                                {{ form_errors(form.closing.moneyBox.contractPrice) }}
                            </span>
                        </div>
                        <div class="form-group">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th width="35%">
                                        Deposit &nbsp;<a class="btn-add" data-target="post_deposit"><i class="icon-plus"></i> Add</a>
                                    </th>
                                    <th width="45%">Date</th>
                                    <th width="5%">Alert</th>
                                    <th width="15%"></th>
                                </tr>
                                </thead>
                                <tbody id="post_deposit" data-prototype="{{ forms.deposit_widget_prototype(form.closing.moneyBox.deposits, 'Remove deposit')|escape }}">
                                {% for widget in form.closing.moneyBox.deposits.children %}
                                    {{ forms.deposit_widget_prototype(widget, 'Remove deposit') }}
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="form-group control-group lisa {% if app.user.businesses[0].id != 50 %} {% if form.vars.value.closing.moneyBox.paymentType is defined and form.vars.value.closing.moneyBox.paymentType is not null and form.vars.value.closing.moneyBox.paymentType != '' %}success{% else %}error{% endif %} {% endif %}">
                            <label class="control-label col-md-3">{{ form_label(form.closing.moneyBox.paymentType) }}</label>
                            <div class="col-md-9">
                                {% if app.user.businesses[0].id != 50 %}
                                    <i class="fa fa-asterisk required_icon" style="{% if form.vars.value.closing.moneyBox.paymentType is defined and form.vars.value.closing.moneyBox.paymentType is not null and form.vars.value.closing.moneyBox.paymentType != '' %}color:rgb(0, 128, 0);{% else %}color:rgb(255, 0, 0);{% endif %}margin-top: -3px; margin-left: -3px; position: absolute; font-size: 9px; z-index: 3;"></i>
                                {% endif %}

                                {{ form_widget(form.closing.moneyBox.paymentType, {'attr':{'style': 'color: #000'}}) }}
                                <span class="help-block">
                                    {{ form_errors(form.closing.moneyBox.paymentType) }}
                                </span>
                            </div>
                        </div>

                        <div class="form-group custom_box">
                            <label class="control-label col-md-3">
                                <i class="fa fa-asterisk required_icon_table loanQuestion"></i>
                                {{ loanQuestion.question }}
                            </label>

                            <div class="col-md-4">
                                <div class="mt-radio-inline">
                                    <label class="mt-radio mt-radio-outline">
                                        {{ form_label(form.closing.moneyBox.loan[0]) }}
                                        {{ form_widget(form.closing.moneyBox.loan[0]) }}
                                        <span></span>
                                    </label>
                                    <label class="mt-radio mt-radio-outline">
                                        {{ form_label(form.closing.moneyBox.loan[1]) }}
                                        {{ form_widget(form.closing.moneyBox.loan[1]) }}
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group required_question">
                            <label class="control-label col-md-3">
                                {% if referralQuestion is not null %}
                                    {{ referralQuestion.question }}
                                {% else %}
                                    {{ form_label(form.closing.moneyBox.referral) }}
                                {% endif %}
                            </label>

                            <div class="col-md-4">
                                <div class="mt-radio-inline">
                                    <label class="mt-radio mt-radio-outline">
                                        {{ form_label(form.closing.moneyBox.referral[0]) }}
                                        {{ form_widget(form.closing.moneyBox.referral[0]) }}
                                        <span></span>
                                    </label>
                                    <label class="mt-radio mt-radio-outline">
                                        {{ form_label(form.closing.moneyBox.referral[1]) }}
                                        {{ form_widget(form.closing.moneyBox.referral[1]) }}
                                        <span></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row custom_box_referral">
                            <label class="control-label col-md-3">Referral fee</label>

                            <div class="col-md-9">
                                {% for widget in form.closing.referrals %}
                                    <div class="col-md-2">
                                        {{ form_widget(widget.type) }}
                                        <span class="help-block">
                                            {{ form_errors(widget.type) }}
                                        </span>
                                    </div>
                                    <div class="col-md-3">
                                        {{ form_widget(widget.value) }}
                                        <span class="help-block">
                                            {{ form_errors(widget.value) }}
                                        </span>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3">Total Commission <a class="advanced_commission">advanced</a><a
                                        class="regular_commission">regular</a></label>

                            <div class="col-md-9">
                                {{ form_widget(form.closing.advancedCommissionBox) }}
                                {% set advancedCommission = 0 %}
                                {% for widget in form.closing.totalCommissions %}

                                    <div class="advanced_{{ advancedCommission }}">
                                        {% if advancedCommission == 1 %}
                                            <div class="col-md-1">
                                                <label class="advancedBox_{{ advancedCommission }}"></label>
                                            </div>
                                        {% endif %}
                                        <div class="col-md-2">
                                            {{ form_widget(widget.type) }}
                                            <span class="help-block">
                                                {{ form_errors(widget.type) }}
                                            </span>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="control-group lisa">
                                                <div class="controls">
                                                    {{ form_widget(widget.value) }}
                                                    <span class="help-block">
                                                {{ form_errors(widget.value) }}
                                            </span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    {% set advancedCommission = advancedCommission + 1 %}
                                {% endfor %}
                            </div>

                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-3">Buyers Agent Commission</label>

                            <div class="col-md-9">
                                {% set advancedCommission = 0 %}
                                {% for widget in form.closing.buyerAgentCommissions %}
                                    <div class="advanced_{{ advancedCommission }}">
                                        {% if advancedCommission == 1 %}
                                            <div class="col-md-1">
                                                <label class="advancedBox_{{ advancedCommission }}"></label>
                                            </div>
                                        {% endif %}
                                        <div class="col-md-2">
                                            {{ form_widget(widget.type) }}
                                            <span class="help-block">
                                                {{ form_errors(widget.type) }}
                                            </span>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="control-group lisa">
                                                <div class="controls">
                                                    {{ form_widget(widget.value) }}
                                                    <span class="help-block">
                                                {{ form_errors(widget.value) }}
                                            </span>
                                                </div>

                                            </div>

                                        </div>
                                    </div>
                                    {% set advancedCommission = advancedCommission + 1 %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-actions" style="text-align:center;">
                    <button {% if closing.status|lower in ['sold_paid', 'contract_fell_thru'] %} disabled {% endif %}
                            type="submit" class="btn btn-success" id="closing-submit"><i class="fa fa-check"></i> Save Closing
                    </button>
                </div>
            </div>
        </div>
        <div class="hidden">
            {{ form_end(form, {'render_rest': false}) }}
        </div>
    </div>
{% endblock %}